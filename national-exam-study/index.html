<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨€èªè´è¦šå£«å›½å®¶è©¦é¨“å¯¾ç­–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx-preview@0.1.0/dist/docx-preview.min.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(to bottom right, #dbeafe, #e0e7ff); }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
// è¨€èªè´è¦šå£«å›½å®¶è©¦é¨“ã‚µãƒ³ãƒ—ãƒ«å•é¡Œ
const sampleQuestions = [
    {
        id: 1,
        category: 'éŸ³å£°ãƒ»åš¥ä¸‹éšœå®³',
        question: 'å£°å¸¯éº»ç—ºã§æœ€ã‚‚å¤šã„åŸå› ã¯ã©ã‚Œã‹ã€‚',
        choices: ['å¤–å‚·', 'ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“', 'åŸå› ä¸æ˜ï¼ˆç‰¹ç™ºæ€§ï¼‰', 'è„³è¡€ç®¡ç–¾æ‚£'],
        correct: 2,
        explanation: 'ç‰¹ç™ºæ€§ãŒæœ€ã‚‚å¤šãã€æ¬¡ã„ã§è„³è¡€ç®¡ç–¾æ‚£ã€å¤–å‚·ã€ã‚¦ã‚¤ãƒ«ã‚¹æ„ŸæŸ“ã®é †ã§ã™ã€‚'
    },
    {
        id: 2,
        category: 'è¨€èªç™ºé”',
        question: 'å°å…ã®æ­£å¸¸ãªèªå½™æ•°ã«ã¤ã„ã¦ã€2æ­³å…ã®å¹³å‡èªå½™æ•°ã¯ã©ã‚Œã‹ã€‚',
        choices: ['50èªç¨‹åº¦', '150èªç¨‹åº¦', '300èªç¨‹åº¦', '500èªä»¥ä¸Š'],
        correct: 1,
        explanation: '2æ­³å…ã®å¹³å‡èªå½™æ•°ã¯ç´„150èªã§ã™ã€‚3æ­³ã§1,000èªã€4æ­³ã§1,600èªç¨‹åº¦ã«å¢—åŠ ã—ã¾ã™ã€‚'
    },
    {
        id: 3,
        category: 'è´è¦šéšœå®³',
        question: 'æ–°ç”Ÿå…è´è¦šã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã®é©å¿œå¹´é½¢ã¯ã©ã‚Œã‹ã€‚',
        choices: ['ç”Ÿå¾Œ24æ™‚é–“ä»¥å†…', 'ç”Ÿå¾Œ3æ—¥ä»¥å†…', 'ç”Ÿå¾Œ1ãƒ¶æœˆä»¥å†…', 'ç”Ÿå¾Œ6ãƒ¶æœˆä»¥å†…'],
        correct: 2,
        explanation: 'æ–°ç”Ÿå…è´è¦šã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã¯ã€ç”Ÿå¾Œ3æ—¥ä»¥å†…ï¼ˆã§ãã‚Œã°ç”Ÿå¾Œ48æ™‚é–“ä»¥å†…ï¼‰ã«å®Ÿæ–½ã™ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚'
    },
    {
        id: 4,
        category: 'æ§‹éŸ³éšœå®³',
        question: 'æ©Ÿèƒ½æ€§æ§‹éŸ³éšœå®³ã§æœ€ã‚‚å¤šã„éŸ³ã®èª¤ã‚Šã¯ã©ã‚Œã‹ã€‚',
        choices: ['/r/éŸ³ã®èª¤ã‚Š', '/s/éŸ³ã®èª¤ã‚Š', '/k/éŸ³ã®èª¤ã‚Š', '/t/éŸ³ã®èª¤ã‚Š'],
        correct: 0,
        explanation: '/r/éŸ³ï¼ˆãƒ©è¡Œï¼‰ã®èª¤ã‚ŠãŒæœ€ã‚‚å¤šãã€æ¬¡ã„ã§/s/éŸ³ï¼ˆã‚µè¡Œï¼‰ã€/k/éŸ³ï¼ˆã‚«è¡Œï¼‰ã®é †ã§ã™ã€‚'
    },
    {
        id: 5,
        category: 'å¤±èªç—‡',
        question: 'ãƒ–ãƒ­ãƒ¼ã‚«å¤±èªç—‡ã®ç‰¹å¾´ã§æ­£ã—ã„ã®ã¯ã©ã‚Œã‹ã€‚',
        choices: ['æ§‹æ–‡éšœå®³ã¯è»½åº¦', 'å¾©å”±ã¯è‰¯å¥½', 'ç†è§£ã¯æ¯”è¼ƒçš„è‰¯å¥½ã ãŒè¡¨å‡ºãŒé‡åº¦', 'å­—æ€§å¤±èªã‚’ä¼´ã†ã“ã¨ãŒå¤šã„'],
        correct: 2,
        explanation: 'ãƒ–ãƒ­ãƒ¼ã‚«å¤±èªã¯ã€ç†è§£ã¯æ¯”è¼ƒçš„ä¿ãŸã‚Œã‚‹ãŒã€è¡¨å‡ºãŒé‡åº¦ã«éšœå®³ã•ã‚Œã‚‹ã®ãŒç‰¹å¾´ã§ã™ã€‚å¾©å”±ã¯ä¸è‰¯ã§ã™ã€‚'
    },
    {
        id: 6,
        category: 'é«˜æ¬¡è„³æ©Ÿèƒ½éšœå®³',
        question: 'æ³¨æ„éšœå®³ã®è©•ä¾¡ã«ç”¨ã„ã‚‰ã‚Œã‚‹æ¤œæŸ»ã¯ã©ã‚Œã‹ã€‚',
        choices: ['ã‚¦ã‚§ã‚¯ã‚¹ãƒ©ãƒ¼æˆäººçŸ¥èƒ½æ¤œæŸ»', 'æ¨™æº–å¤±èªç—‡æ¤œæŸ»', 'Trail Making Test', 'ãƒ”ãƒƒãƒ„ãƒãƒ¼ã‚°ç¡çœ è©•ä¾¡è³ªå•ç¥¨'],
        correct: 2,
        explanation: 'Trail Making Testï¼ˆTMTï¼‰ã¯ã€æ³¨æ„æ©Ÿèƒ½ã‚„é‚è¡Œæ©Ÿèƒ½ã‚’è©•ä¾¡ã™ã‚‹ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã¾ã™ã€‚'
    },
    {
        id: 7,
        category: 'åš¥ä¸‹æ©Ÿèƒ½',
        question: 'åš¥ä¸‹é€ å½±æ¤œæŸ»ã§ç¢ºèªã™ã¹ãé …ç›®ã§ãªã„ã®ã¯ã©ã‚Œã‹ã€‚',
        choices: ['æ‘‚é£Ÿåš¥ä¸‹ã®å§¿å‹¢', 'å’½é ­æ®‹ç•™', 'èƒƒé…¸åˆ†æ³Œé‡', 'èª¤åš¥ã®æœ‰ç„¡'],
        correct: 2,
        explanation: 'èƒƒé…¸åˆ†æ³Œé‡ã¯åš¥ä¸‹é€ å½±ã§ã¯è©•ä¾¡ã§ãã¾ã›ã‚“ã€‚å§¿å‹¢ã€æ®‹ç•™ã€èª¤åš¥ã®æœ‰ç„¡ã€å’½é ­ã¸ã®æµå…¥ãªã©ãŒç¢ºèªã•ã‚Œã¾ã™ã€‚'
    },
    {
        id: 8,
        category: 'éŸ³å£°éšœå®³',
        question: 'éŸ³å£°ã®åŸºæœ¬çš„ãªå±æ€§ï¼ˆéŸ³ã®ä¸‰è¦ç´ ï¼‰ã«å«ã¾ã‚Œãªã„ã®ã¯ã©ã‚Œã‹ã€‚',
        choices: ['ãƒ”ãƒƒãƒï¼ˆéŸ³é«˜ï¼‰', 'ãƒ©ã‚¦ãƒ‰ãƒã‚¹ï¼ˆéŸ³ã®å¤§ãã•ï¼‰', 'ã‚¯ã‚ªãƒªãƒ†ã‚£ï¼ˆéŸ³è³ªï¼‰', 'ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆå¤‰ä½ï¼‰'],
        correct: 3,
        explanation: 'éŸ³ã®ä¸‰è¦ç´ ã¯ã€ãƒ”ãƒƒãƒï¼ˆéŸ³é«˜ï¼‰ã€ãƒ©ã‚¦ãƒ‰ãƒã‚¹ï¼ˆéŸ³ã®å¤§ãã•ï¼‰ã€ã‚¯ã‚ªãƒªãƒ†ã‚£ï¼ˆéŸ³è³ªï¼‰ã§ã™ã€‚'
    },
    {
        id: 9,
        category: 'è¨€èªç™ºé”',
        question: 'èªå½™çˆ†ç™ºæœŸï¼ˆvocabulary spurtï¼‰ãŒèµ·ã“ã‚‹ã®ã¯ä½•æ­³é ƒã‹ã€‚',
        choices: ['1æ­³é ƒ', '1æ­³6ãƒ¶æœˆé ƒ', '2æ­³é ƒ', '3æ­³é ƒ'],
        correct: 2,
        explanation: 'èªå½™çˆ†ç™ºæœŸã¯1æ­³6ãƒ¶æœˆï½2æ­³é ƒã«èµ·ã“ã‚Šã€æ€¥é€Ÿã«èªå½™æ•°ãŒå¢—åŠ ã—ã¾ã™ã€‚'
    },
    {
        id: 10,
        category: 'è´è¦šéšœå®³',
        question: 'ç´”éŸ³è´åŠ›æ¤œæŸ»ã§æ¸¬å®šã™ã‚‹ã®ã¯ã©ã‚Œã‹ã€‚',
        choices: ['ä¼šè©±æ˜ç­åº¦', 'èªéŸ³å¼åˆ¥èƒ½', 'è´è¦šé–¾å€¤', 'è´è¦šé‡ã®æ´»æ€§åŒ–åº¦'],
        correct: 2,
        explanation: 'ç´”éŸ³è´åŠ›æ¤œæŸ»ã¯ã€å„å‘¨æ³¢æ•°ã§ã®è´è¦šé–¾å€¤ã‚’æ¸¬å®šã—ã¾ã™ã€‚'
    }
];

let state = {
    questions: sampleQuestions,
    currentIndex: 0,
    selectedAnswer: null,
    showAnswer: false,
    score: 0,
    totalAnswered: 0,
    reviewMode: false,
    incorrectQuestions: []
};

function render() {
    const s = state;
    const q = s.questions[s.currentIndex];
    
    const answerButtons = q.choices.map((choice, index) => {
        let bgColor = 'bg-gray-100 hover:bg-gray-200';
        
        if (s.showAnswer) {
            if (index === q.correct) {
                bgColor = 'bg-green-100 border-2 border-green-500';
            } else if (index === s.selectedAnswer && index !== q.correct) {
                bgColor = 'bg-red-100 border-2 border-red-500';
            }
        }

        if (s.showAnswer) {
            return `
                <button disabled
                    class="w-full text-left p-4 rounded-lg transition-all ${bgColor}">
                    <div class="flex items-center">
                        <span class="font-bold mr-3 w-8 h-8 flex items-center justify-center rounded-full bg-white">
                            ${index + 1}
                        </span>
                        <span class="flex-1">${choice}</span>
                        ${index === q.correct ? '<span class="text-green-600 font-bold ml-2">âœ“</span>' : ''}
                        ${index === s.selectedAnswer && index !== q.correct ? '<span class="text-red-600 font-bold ml-2">âœ—</span>' : ''}
                    </div>
                </button>
            `;
        } else {
            return `
                <button onclick="handleAnswer(${index})"
                    class="w-full text-left p-4 rounded-lg transition-all ${bgColor} cursor-pointer active:scale-95">
                    <div class="flex items-center">
                        <span class="font-bold mr-3 w-8 h-8 flex items-center justify-center rounded-full bg-white">
                            ${index + 1}
                        </span>
                        <span class="flex-1">${choice}</span>
                    </div>
                </button>
            `;
        }
    }).join('');

    document.getElementById('root').innerHTML = `
        <div class="min-h-screen gradient-bg p-4">
            <div class="max-w-4xl mx-auto">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <header class="bg-white rounded-lg card-shadow p-6 mb-6">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">è¨€èªè´è¦šå£«å›½å®¶è©¦é¨“å¯¾ç­–</h1>
                    <p class="text-gray-600">STï¼ˆSpeech-Language-Hearing Therapistï¼‰å›½å®¶è©¦é¨“ã®éå»å•å¯¾ç­–</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs">ç™ºé”</span>
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs">å¤±èªç—‡</span>
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs">åš¥ä¸‹</span>
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs">è´è¦š</span>
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs">éŸ³å£°</span>
                    </div>
                    ${s.reviewMode ? '<div class="mt-3 bg-orange-100 text-orange-800 px-4 py-2 rounded-lg font-medium">ğŸ”„ å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰</div>' : ''}
                    
                    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="text-sm text-blue-800 mb-2">
                            <strong>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å•é¡Œã‚’èª­ã¿è¾¼ã‚€</strong>
                        </div>
                        <div class="space-y-2">
                            <input type="file" id="wordFileInput" accept=".docx,.doc" onchange="handleWordFileUpload(event)"
                                   class="text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-500 file:text-white hover:file:bg-indigo-600 mr-2" />
                            <span class="text-xs text-gray-500">Wordå½¢å¼ (.docx)</span>
                        </div>
                        <div class="space-y-2 mt-2">
                            <input type="file" id="csvFileInput" accept=".csv" onchange="handleCSVFileUpload(event)" 
                                   class="text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-500 file:text-white hover:file:bg-green-600" />
                            <span class="text-xs text-gray-500">CSVå½¢å¼ (.csv)</span>
                        </div>
                        <div class="text-xs text-gray-600 mt-3 p-2 bg-white rounded">
                            <strong>Wordå½¢å¼ã®èª­ã¿è¾¼ã¿ï¼š</strong><br/>
                            Wordãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•çš„ã«è§£æã—ã¾ã™ã€‚
                        </div>
                    </div>
                </header>

                <!-- ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
                <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-blue-600">${s.score}</div>
                            <div class="text-sm text-gray-600">æ­£è§£æ•°</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-green-600">${s.totalAnswered > 0 ? Math.round((s.score / s.totalAnswered) * 100) : 0}%</div>
                            <div class="text-sm text-gray-600">æ­£ç­”ç‡</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4">
                            <div class="text-2xl font-bold text-purple-600">${s.incorrectQuestions.length}</div>
                            <div class="text-sm text-gray-600">å¾©ç¿’å•é¡Œ</div>
                        </div>
                    </div>
                </div>

                <!-- å•é¡Œã‚«ãƒ¼ãƒ‰ -->
                <div class="bg-white rounded-lg card-shadow p-8 mb-6">
                    <div class="mb-4">
                        <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">${q.category}</span>
                        <span class="ml-4 text-gray-500">å•é¡Œ ${s.currentIndex + 1} / ${s.questions.length}</span>
                    </div>

                    <h2 class="text-xl font-semibold text-gray-800 mb-6">${q.question}</h2>

                    <div class="space-y-3">${answerButtons}</div>

                    ${s.showAnswer ? `
                        <div class="mt-6 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                            <div class="font-semibold text-indigo-800 mb-2">è§£èª¬</div>
                            <div class="text-gray-700">${q.explanation}</div>
                        </div>
                    ` : ''}
                </div>

                <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div class="bg-white rounded-lg card-shadow p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        ${s.currentIndex === 0 ? 
                            '<button class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg opacity-50 cursor-not-allowed font-medium transition">â† å‰ã®å•é¡Œ</button>' :
                            '<button onclick="handlePrevious()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium transition">â† å‰ã®å•é¡Œ</button>'
                        }
                        <div class="space-x-3">
                            ${s.incorrectQuestions.length === 0 ?
                                '<button class="px-6 py-3 bg-orange-500 text-white rounded-lg opacity-50 cursor-not-allowed font-medium transition">ğŸ“š é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’</button>' :
                                '<button onclick="handleReview()" class="px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium transition">ğŸ“š é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’</button>'
                            }
                            <button onclick="handleReset()"
                                class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 font-medium transition">
                                ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
                            </button>
                        </div>
                        ${s.currentIndex === s.questions.length - 1 ?
                            '<button class="px-6 py-3 bg-indigo-500 text-white rounded-lg opacity-50 cursor-not-allowed font-medium transition">æ¬¡ã®å•é¡Œ â†’</button>' :
                            '<button onclick="handleNext()" class="px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 font-medium transition">æ¬¡ã®å•é¡Œ â†’</button>'
                        }
                    </div>
                </div>

                <!-- é€²æ—ãƒãƒ¼ -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>é€²æ—</span>
                        <span>${s.currentIndex + 1} / ${s.questions.length}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-indigo-500 h-3 rounded-full transition-all duration-300"
                             style="width: ${((s.currentIndex + 1) / s.questions.length) * 100}%"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function handleAnswer(index) {
    if (state.showAnswer) return;
    state.selectedAnswer = index;
    state.showAnswer = true;
    state.totalAnswered++;
    if (index === state.questions[state.currentIndex].correct) {
        state.score++;
    } else {
        state.incorrectQuestions.push(state.questions[state.currentIndex]);
    }
    render();
}

function handleNext() {
    if (state.currentIndex < state.questions.length - 1) {
        state.currentIndex++;
        state.selectedAnswer = null;
        state.showAnswer = false;
        render();
    }
}

function handlePrevious() {
    if (state.currentIndex > 0) {
        state.currentIndex--;
        state.selectedAnswer = null;
        state.showAnswer = false;
        render();
    }
}

function handleReview() {
    if (state.incorrectQuestions.length === 0) {
        alert('å¾©ç¿’ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼ã™ã¹ã¦æ­£è§£ã§ã™ã€‚');
        return;
    }
    state.questions = state.incorrectQuestions;
    state.currentIndex = 0;
    state.incorrectQuestions = [];
    state.reviewMode = true;
    state.showAnswer = false;
    state.selectedAnswer = null;
    render();
}

function handleReset() {
    state.questions = sampleQuestions;
    state.currentIndex = 0;
    state.selectedAnswer = null;
    state.showAnswer = false;
    state.score = 0;
    state.totalAnswered = 0;
    state.incorrectQuestions = [];
    state.reviewMode = false;
    render();
}

function handleWordFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const arrayBuffer = e.target.result;
        
        // docx-previewã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡º
        try {
            const docx = new PizZip(arrayBuffer);
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ç°¡å˜ãªæ–¹æ³•
            const xml = docx.files['word/document.xml'].asText();
            
            // XMLã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã‚’æŠ½å‡º
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xml, 'text/xml');
            const texts = xmlDoc.getElementsByTagName('w:t');
            let fullText = '';
            for (let i = 0; i < texts.length; i++) {
                fullText += texts[i].textContent + '\n';
            }
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æã—ã¦å•é¡Œã‚’ä½œæˆ
            const questions = parseWordTextToQuestions(fullText);
            
            if (questions.length === 0) {
                alert('Wordãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å•é¡Œã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚\nå½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            state.questions = questions;
            state.currentIndex = 0;
            state.selectedAnswer = null;
            state.showAnswer = false;
            state.score = 0;
            state.totalAnswered = 0;
            state.incorrectQuestions = [];
            state.reviewMode = false;
            
            render();
            alert(`${questions.length}å•ã®å•é¡Œã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
        } catch (error) {
            console.error('Wordãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            alert('Wordãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå£Šã‚Œã¦ã„ã‚‹ã‹ã€å¯¾å¿œã—ã¦ã„ãªã„å½¢å¼ã§ã™ã€‚');
        }
    };
    
    reader.readAsArrayBuffer(file);
}

function parseWordTextToQuestions(text) {
    // ã‚·ãƒ³ãƒ—ãƒ«ãªè§£æï¼šè¡Œã”ã¨ã«å‡¦ç†
    const lines = text.split('\n').filter(line => line.trim());
    const questions = [];
    let currentQuestion = null;
    let choiceIndex = 0;
    
    for (let line of lines) {
        line = line.trim();
        
        // ç©ºè¡Œã¯ç„¡è¦–
        if (!line) continue;
        
        // æ•°å­—ã§å§‹ã¾ã‚‹è¡Œã‚’å•é¡Œã®é–‹å§‹ã¨ã—ã¦èªè­˜
        if (/^\d+[\.\)]/.test(line)) {
            // å‰ã®å•é¡Œã‚’ä¿å­˜
            if (currentQuestion) {
                questions.push(currentQuestion);
            }
            
            // æ–°ã—ã„å•é¡Œã‚’ä½œæˆ
            const questionText = line.replace(/^\d+[\.\)]/, '').trim();
            currentQuestion = {
                id: questions.length + 1,
                category: 'æœªåˆ†é¡',
                question: questionText,
                choices: [],
                correct: 0,
                explanation: ''
            };
            choiceIndex = 0;
        } else if (currentQuestion && /^[â‘ â‘¡â‘¢â‘£â‘¤]/) {
            // é¸æŠè‚¢ï¼ˆâ‘ â‘¡â‘¢â‘£â‘¤è¨˜å·ï¼‰
            const choiceText = line.replace(/^[â‘ â‘¡â‘¢â‘£â‘¤][\.\)]/, '').trim();
            currentQuestion.choices.push(choiceText);
        } else if (currentQuestion && /^[1-5][\.\)]/.test(line)) {
            // é¸æŠè‚¢ï¼ˆæ•°å­—ï¼‰
            const choiceText = line.replace(/^[1-5][\.\)]/, '').trim();
            currentQuestion.choices.push(choiceText);
            choiceIndex++;
        } else if (line.includes('æ­£è§£') || line.includes('æ­£ç­”')) {
            // æ­£è§£è¡Œ
            const match = line.match(/\d+/);
            if (match) {
                currentQuestion.correct = parseInt(match[0]) - 1;
            }
        } else if (currentQuestion && currentQuestion.choices.length === 0) {
            // å•é¡Œæ–‡ã®ç¶šã
            currentQuestion.question += ' ' + line;
        }
    }
    
    // æœ€å¾Œã®å•é¡Œã‚’è¿½åŠ 
    if (currentQuestion) {
        questions.push(currentQuestion);
    }
    
    // é¸æŠè‚¢ãŒ4ã¤æœªæº€ã®å ´åˆã«è£œå®Œ
    questions.forEach(q => {
        if (q.choices.length < 4) {
            while (q.choices.length < 4) {
                q.choices.push('æœªè¨­å®šã®é¸æŠè‚¢');
            }
        }
    });
    
    return questions;
}

function handleCSVFileUpload(event) {
    handleFileUpload(event);
}

function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const csv = e.target.result;
        const lines = csv.split('\n');
        
        if (lines.length < 2) {
            alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã§ã™ã€‚');
            return;
        }
        
        // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚ã‚Œã°ï¼‰
        const dataLines = lines.slice(1).filter(line => line.trim());
        
        const importedQuestions = dataLines.map((line, index) => {
            const parts = line.split(',');
            if (parts.length < 3) return null;
            
            // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: category,question,choice1,choice2,choice3,choice4,choice5,correct,explanation
            const category = parts[0].trim();
            const question = parts[1].trim();
            const choices = [
                parts[2]?.trim() || '',
                parts[3]?.trim() || '',
                parts[4]?.trim() || '',
                parts[5]?.trim() || '',
                parts[6]?.trim() || ''
            ].filter(c => c); // ç©ºæ–‡å­—ã‚’å‰Šé™¤
            
            const correct = parseInt(parts[7]?.trim() || '0');
            const explanation = parts[8]?.trim() || '';
            
            return {
                id: index + 1,
                category: category || 'æœªåˆ†é¡',
                question: question,
                choices: choices.length === 4 ? choices : ['é¸æŠè‚¢1', 'é¸æŠè‚¢2', 'é¸æŠè‚¢3', 'é¸æŠè‚¢4'],
                correct: correct - 1, // 1å§‹ã¾ã‚Šã‚’0å§‹ã¾ã‚Šã«å¤‰æ›
                explanation: explanation
            };
        }).filter(q => q);
        
        if (importedQuestions.length === 0) {
            alert('å•é¡Œã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚CSVã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        state.questions = importedQuestions;
        state.currentIndex = 0;
        state.selectedAnswer = null;
        state.showAnswer = false;
        state.score = 0;
        state.totalAnswered = 0;
        state.incorrectQuestions = [];
        state.reviewMode = false;
        
        render();
        alert(`${importedQuestions.length}å•ã®å•é¡Œã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
    };
    
    reader.readAsText(file, 'UTF-8');
}

// åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
render();
    </script>
</body>
</html>