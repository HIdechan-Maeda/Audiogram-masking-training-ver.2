{"ast":null,"code":"import _objectSpread from\"/Users/maedahidehiko/Documents/myAudiogram builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo,useRef,useLayoutEffect}from\"react\";import{ResponsiveContainer,ComposedChart,XAxis,YAxis,CartesianGrid,Scatter,Line}from\"recharts\";// Audiogram-first Masking Trainer (MVP v2.4.9)\n// - 1oct/grid x 10dB ticks; 1oct == 20dB; AC O/X, BC </> []\n// - Overlay blink; legend right-side panel; masking slider in header\n// - Fix: add targetMap + getThr() → resolves \"getThr is not defined\"\n// --- constants ---\n// Optional click→dB calibration offset (kept 0 as per spec 1/2/3)\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CAL_OFFSET_DB=0;const BC_DISABLED=new Set([125,8000]);// BCは125Hz/8000Hzは測定対象外\nconst FREQS=[125,250,500,1000,2000,4000,8000];// 7 points -> 6 octaves\n// Slight domain padding to prevent edge clipping without changing visible tick positions\nconst X_DOMAIN=[0,FREQS.length-1];const Y_MIN=-10;// dB HL (top small, bottom large)\nconst Y_MAX=120;// 10 dB ticks (render squares use 20 dB cells)\nconst CHART_SCALE=1;// Geometry to force 1 octave (X) == 20 dB (Y)\nconst CELL_PX=100;// px per 1 octave (== 20 dB) — larger, keeps square cells\nconst GRID_W=CELL_PX*(FREQS.length-1);// 6 octaves\nconst GRID_H=CELL_PX*((Y_MAX-Y_MIN)/20);// vertical cells of 20 dB\nconst AXIS_LEFT=64,AXIS_RIGHT=40,AXIS_TOP=20,AXIS_BOTTOM=48;// increase top to avoid clipping -10 dB tick\nconst CHART_MARGIN={top:AXIS_TOP,right:AXIS_RIGHT,bottom:AXIS_BOTTOM,left:AXIS_LEFT};// plotting box = GRID_W x GRID_H\n// Interaural Attenuation (IA): AC=50 dB, BC=0 dB\nconst IA={AC:50,BC:0};// Max presentable levels (for Scale-Out logic)\nconst AC_MAX={125:70,250:90,500:110,1000:110,2000:110,4000:110,8000:100};const BC_MAX={250:55,500:65,1000:70,2000:70,4000:60};// Marker size for AC/BC symbols (px). 24px target → radius 12, thicker stroke.\nconst MARK_R=8;// radius (smaller markers)\nconst MARK_STROKE=2;// Safe tick formatter for X axis (1 octave grid labels)\nfunction formatFreq(v){const i=Math.round(typeof v==='number'?v:0);return String(FREQS&&FREQS[i]!=null?FREQS[i]:\"\");}// Legend / rendering series\nconst SERIES=[{key:\"R-AC-U\",label:\"Right AC (unmasked)\",color:\"#ef4444\",shape:\"O\"},{key:\"R-AC-M\",label:\"Right AC (masked)\",color:\"#b91c1c\",shape:\"O\"},{key:\"L-AC-U\",label:\"Left  AC (unmasked)\",color:\"#3b82f6\",shape:\"X\"},{key:\"L-AC-M\",label:\"Left  AC (masked)\",color:\"#1d4ed8\",shape:\"X\"},{key:\"R-BC-U\",label:\"Right BC (unmasked)\",color:\"#ef4444\",shape:\"lt\"},{key:\"R-BC-M\",label:\"Right BC (masked)\",color:\"#b91c1c\",shape:\"lbracket\"},{key:\"L-BC-U\",label:\"Left  BC (unmasked)\",color:\"#3b82f6\",shape:\"gt\"},{key:\"L-BC-M\",label:\"Left  BC (masked)\",color:\"#1d4ed8\",shape:\"rbracket\"}];// --- preset helpers (compress verbose targets to keep file small) --- (compress verbose targets to keep file small) ---\nconst mk=(ear,transducer,list)=>list.map(_ref=>{let[freq,dB,so=false]=_ref;return _objectSpread({ear,transducer,masked:false,freq,dB},so?{so:true}:{});});const preset=(name,parts)=>({name,targets:parts.flat()});// --- Preset cases (targets kept \"secret\"; used for overlay/validation only) ---\n// Each target: { ear:'R'|'L', transducer:'AC'|'BC', masked:false, freq:number, dB:number, so?:true }\nconst PRESET_A=preset('症例A',[mk('R','AC',[[125,5],[250,5],[500,5],[1000,5],[2000,5],[4000,0],[8000,0]]),mk('L','AC',[[125,10],[250,10],[500,5],[1000,5],[2000,5],[4000,0],[8000,-5]]),mk('R','BC',[[250,5],[500,10],[1000,5],[2000,5],[4000,-5]]),mk('L','BC',[[250,5],[500,5],[1000,0],[2000,5],[4000,0]])]);const PRESET_B=preset('症例B',[// Right AC / BC\nmk('R','AC',[[125,10],[500,30],[1000,50],[2000,70],[4000,90],[8000,100]]),mk('R','BC',[[500,30],[1000,50],[2000,70],[4000,90]]),// Left AC / BC\nmk('L','AC',[[125,15],[250,15],[500,10],[1000,10],[2000,5],[4000,5],[8000,10]]),mk('L','BC',[[250,15],[500,10],[1000,10],[2000,5],[4000,5]])]);const PRESET_C=preset('症例C',[// Right AC / BC\nmk('R','AC',[[125,20],[250,20],[500,15],[1000,10],[2000,10],[4000,5],[8000,5]]),mk('R','BC',[[250,15],[500,15],[1000,10],[2000,5],[4000,10]]),// Left AC/BC (SO)\nmk('L','AC',[[125,110,true],[250,110,true],[500,110,true],[1000,110,true],[2000,110,true],[4000,110,true],[8000,110,true]]),mk('L','BC',[[250,110,true],[500,110,true],[1000,110,true],[2000,110,true],[4000,110,true]])]);const PRESET_D=preset('症例D',[// Right AC / BC - 高音域の聴力低下\nmk('R','AC',[[125,5],[250,5],[500,5],[1000,10],[2000,25],[4000,45],[8000,65]]),mk('R','BC',[[250,5],[500,5],[1000,10],[2000,20],[4000,35]]),// Left AC / BC - 低音域の聴力低下\nmk('L','AC',[[125,25],[250,30],[500,20],[1000,10],[2000,5],[4000,5],[8000,10]]),mk('L','BC',[[250,25],[500,20],[1000,10],[2000,5],[4000,5]])]);const PRESET_E=preset('症例E',[// Right AC / BC - 混合性難聴パターン\nmk('R','AC',[[125,15],[250,20],[500,20],[1000,30],[2000,35],[4000,35],[8000,45]]),mk('R','BC',[[250,15],[500,20],[1000,25],[2000,30],[4000,35]]),// Left AC / BC - 感音性難聴パターン\nmk('L','AC',[[125,40],[250,45],[500,40],[1000,55],[2000,60],[4000,60],[8000,70]]),mk('L','BC',[[250,40],[500,45],[1000,50],[2000,55],[4000,60]])]);const PRESET_F=preset('症例F',[// Right AC / BC - 感音難聴（高音漸傾型）\nmk('R','AC',[[125,10],[250,15],[500,20],[1000,30],[2000,45],[4000,65],[8000,80]]),mk('R','BC',[[250,15],[500,20],[1000,30],[2000,45],[4000,65]]),// Left AC / BC - 感音難聴（高音漸傾型、左右同じ）\nmk('L','AC',[[125,10],[250,15],[500,20],[1000,30],[2000,45],[4000,65],[8000,80]]),mk('L','BC',[[250,15],[500,20],[1000,30],[2000,45],[4000,65]])]);function buildTargetsFromPreset(preset){return preset.targets.map(t=>_objectSpread({},t));}// helpers\nfunction clamp(n,lo,hi){return Math.max(lo,Math.min(hi,n));}function round5(n){return Math.round(n/5)*5;}function seriesKey(p){return\"\".concat(p.ear,\"-\").concat(p.transducer,\"-\").concat(p.masked?\"M\":\"U\");}function isResponse(points,t){return points.some(p=>p.ear===t.ear&&p.transducer===t.transducer&&p.masked===t.masked&&p.freq===t.freq&&p.dB>=t.dB);}// PRESENTATION LIMIT (fix for ReferenceError: maxPresentable is not defined)\nfunction maxPresentable(transKey,f){var _AC_MAX$f,_BC_MAX$f;return transKey==='AC'?(_AC_MAX$f=AC_MAX[f])!==null&&_AC_MAX$f!==void 0?_AC_MAX$f:110:(_BC_MAX$f=BC_MAX[f])!==null&&_BC_MAX$f!==void 0?_BC_MAX$f:110;}// shape renderer (adds SO arrow if payload.so)\nfunction shapeRenderer(shape,color){return props=>{const{cx,cy,payload}=props;const r=MARK_R;const t=MARK_STROKE;const so=payload&&payload.so;const Arrow=so?/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"line\",{x1:cx,y1:cy+r+2,x2:cx,y2:cy+r+10,stroke:color,strokeWidth:t}),/*#__PURE__*/_jsx(\"line\",{x1:cx-4,y1:cy+r+6,x2:cx,y2:cy+r+10,stroke:color,strokeWidth:t}),/*#__PURE__*/_jsx(\"line\",{x1:cx+4,y1:cy+r+6,x2:cx,y2:cy+r+10,stroke:color,strokeWidth:t})]}):null;switch(shape){case'O':return/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(\"circle\",{cx:cx,cy:cy,r:r,stroke:color,strokeWidth:t,fill:\"white\"}),Arrow]});case'X':return/*#__PURE__*/_jsxs(\"g\",{stroke:color,strokeWidth:t,children:[/*#__PURE__*/_jsx(\"line\",{x1:cx-r,y1:cy-r,x2:cx+r,y2:cy+r}),/*#__PURE__*/_jsx(\"line\",{x1:cx-r,y1:cy+r,x2:cx+r,y2:cy-r}),Arrow]});case'lbracket':// [ (masked BC Right) - 左にずらす\nconst lbracketOffset=-3;// 右耳BCを左に3pxずらす\nreturn/*#__PURE__*/_jsxs(\"g\",{stroke:color,strokeWidth:t,fill:\"none\",children:[/*#__PURE__*/_jsx(\"line\",{x1:cx-r+lbracketOffset,y1:cy-r,x2:cx-r+lbracketOffset,y2:cy+r}),/*#__PURE__*/_jsx(\"line\",{x1:cx-r+lbracketOffset,y1:cy-r,x2:cx-r/3+lbracketOffset,y2:cy-r}),/*#__PURE__*/_jsx(\"line\",{x1:cx-r+lbracketOffset,y1:cy+r,x2:cx-r/3+lbracketOffset,y2:cy+r}),Arrow]});case'rbracket':// ] (masked BC Left) - 右にずらす\nconst rbracketOffset=3;// 左耳BCを右に3pxずらす\nreturn/*#__PURE__*/_jsxs(\"g\",{stroke:color,strokeWidth:t,fill:\"none\",children:[/*#__PURE__*/_jsx(\"line\",{x1:cx+r+rbracketOffset,y1:cy-r,x2:cx+r+rbracketOffset,y2:cy+r}),/*#__PURE__*/_jsx(\"line\",{x1:cx+r+rbracketOffset,y1:cy-r,x2:cx+r/3+rbracketOffset,y2:cy-r}),/*#__PURE__*/_jsx(\"line\",{x1:cx+r+rbracketOffset,y1:cy+r,x2:cx+r/3+rbracketOffset,y2:cy+r}),Arrow]});case'lt':// < (unmasked BC Right) - 左にずらす\nconst ltOffset=-3;// 右耳BCを左に3pxずらす\nreturn/*#__PURE__*/_jsxs(\"g\",{stroke:color,strokeWidth:t,fill:\"none\",children:[/*#__PURE__*/_jsx(\"line\",{x1:cx+r+ltOffset,y1:cy-r,x2:cx-r/3+ltOffset,y2:cy}),/*#__PURE__*/_jsx(\"line\",{x1:cx+r+ltOffset,y1:cy+r,x2:cx-r/3+ltOffset,y2:cy}),Arrow]});case'gt':// > (unmasked BC Left) - 右にずらす\nconst gtOffset=3;// 左耳BCを右に3pxずらす\nreturn/*#__PURE__*/_jsxs(\"g\",{stroke:color,strokeWidth:t,fill:\"none\",children:[/*#__PURE__*/_jsx(\"line\",{x1:cx-r+gtOffset,y1:cy-r,x2:cx+r/3+gtOffset,y2:cy}),/*#__PURE__*/_jsx(\"line\",{x1:cx-r+gtOffset,y1:cy+r,x2:cx+r/3+gtOffset,y2:cy}),Arrow]});default:return/*#__PURE__*/_jsx(\"circle\",{cx:cx,cy:cy,r:r,fill:color});}};}// Legend icon that reuses chart shapes instead of color squares\nfunction LegendMark(_ref2){let{shape,color}=_ref2;const size=MARK_R*2+8;// padding around the symbol\nconst render=shapeRenderer(shape,color);return/*#__PURE__*/_jsx(\"svg\",{width:size,height:size,viewBox:\"0 0 \".concat(size,\" \").concat(size),\"aria-hidden\":true,children:/*#__PURE__*/_jsx(\"g\",{transform:\"translate(\".concat(size/2,\", \").concat(size/2,\")\"),children:render({cx:0,cy:0,payload:{}})})});}export default function AudiogramMaskingMVP(){// 講習会用パスワード保護\nconst[isAuthenticated,setIsAuthenticated]=useState(false);const[password,setPassword]=useState('');const TRAINING_PASSWORD='audiogram2024';// 講習会用パスワード\n// Basic UI state\nconst[ear,setEar]=useState('R');// 'R' | 'L'\nconst[trans,setTrans]=useState('AC');// 'AC' | 'BC'\nconst[masked,setMasked]=useState(false);const[freq,setFreq]=useState(1000);const[maskLevel,setMaskLevel]=useState(-15);// masking amount (dB); -15 means no masking\nconst[level,setLevel]=useState(30);const[points,setPoints]=useState([]);const[suppressLamp,setSuppressLamp]=useState(false);// 周波数切替時に一時的にランプ消灯\nconst[showLegend,setShowLegend]=useState(true);// ← FIX: define showLegend state\n// Preset targets (secret answer)\nconst[targets,setTargets]=useState([]);const[selectedPreset,setSelectedPreset]=useState('A');// Refs / layout\nconst containerRef=useRef(null);const chartHostRef=useRef(null);const overlayRef=useRef(null);const plotCalRef=useRef({scaleY:1,deltaTop:0});// Fixed-size chart: plotting area derived from CELL_PX and margins (no ResponsiveContainer)\nconst chartW=GRID_W+AXIS_LEFT+AXIS_RIGHT;// widened right margin to avoid 8000 label clipping\nconst chartH=GRID_H+AXIS_TOP+AXIS_BOTTOM;// Auto-hide legend if plotting box is too small (safety)\nuseEffect(()=>{setShowLegend(chartH*CHART_SCALE>220);},[chartH]);// --- Plot calibration: measure real grid box and align overlay ---\nuseLayoutEffect(()=>{const host=chartHostRef.current;const ov=overlayRef.current;if(!host||!ov)return;const gridG=host.querySelector('g.recharts-cartesian-grid');if(!gridG||!gridG.getBoundingClientRect)return;const gridRect=gridG.getBoundingClientRect();const ovRect=ov.getBoundingClientRect();const scaleY=gridRect.height/Math.max(1,ovRect.height);const deltaTop=gridRect.top-ovRect.top;// 上端の差（オーバーレイ→グリッド）\nplotCalRef.current={scaleY,deltaTop};});// --- Dev sanity checks (non-intrusive) ---\nuseEffect(()=>{try{var _tmap$get;console.assert(Array.isArray(FREQS)&&FREQS.length===7,'FREQS should have 7 items');console.assert(SERIES.every(s=>s.key&&s.color&&s.shape),'SERIES entries must have key/color/shape');const sampleTicks=Array.from({length:FREQS.length},(_,i)=>i).map(formatFreq);console.assert(sampleTicks.every(t=>String(t).length>0),'formatFreq should produce labels');// quick unit-like check for getThr mapping using PRESET_A\nconst tmap=new Map();PRESET_A.targets.filter(t=>t.masked===false).forEach(t=>{var _AC_MAX$t$freq,_BC_MAX$t$freq;const key=\"\".concat(t.ear,\"|\").concat(t.transducer,\"|\").concat(t.freq);const base=t.so?(t.transducer==='AC'?(_AC_MAX$t$freq=AC_MAX[t.freq])!==null&&_AC_MAX$t$freq!==void 0?_AC_MAX$t$freq:110:(_BC_MAX$t$freq=BC_MAX[t.freq])!==null&&_BC_MAX$t$freq!==void 0?_BC_MAX$t$freq:110)+50:t.dB;tmap.set(key,{dB:base});});const k='R|AC|1000';console.assert(((_tmap$get=tmap.get(k))===null||_tmap$get===void 0?void 0:_tmap$get.dB)===5,'getThr baseline sanity (R AC 1kHz should be 5 dB)');// helpers\nconsole.assert(round5(52)===50&&round5(53)===55,'round5 should snap to nearest 5');console.assert(maxPresentable('AC',1000)===110,'AC max @1k should be 110');// ensure getThr (component-scope) resolves with targetMap in place\nconsole.assert(Number.isFinite(getThr('R','AC',1000)),'getThr should resolve for R AC 1k');// === Added self-tests per spec (1) 5dB丸め, (2) -10/120クランプ, (3) 0/50/100整合 ===\n// Pure mapping test with synthetic geometry\nconst yMin=-10,yMax=120,gridH=yMax-yMin;// 1px == 1dB for synthetic\nconst mapYToDb=y=>yMin+Math.max(0,Math.min(gridH,y))/gridH*(yMax-yMin);const assertNear5=(val,expect)=>console.assert(Math.abs(round5(val)-expect)<=0,\"round5(\".concat(val,\") ~= \").concat(expect));assertNear5(mapYToDb(0),-10);assertNear5(mapYToDb(gridH*0.5),55);// 中央\nassertNear5(mapYToDb(gridH),120);// clamp extremes\nconsole.assert(Math.min(yMax,Math.max(yMin,-15))===-10,'clamp top to -10dB');console.assert(Math.min(yMax,Math.max(yMin,130))===120,'clamp bottom to 120dB');// showLegend presence\nconsole.assert(typeof showLegend==='boolean','showLegend should be boolean');// masking logic quick checks\nconst targets=PRESET_A.targets;const localMap=new Map();targets.filter(t=>t.masked===false).forEach(t=>{var _AC_MAX$t$freq2,_BC_MAX$t$freq2;const overMax=(t.transducer==='AC'?(_AC_MAX$t$freq2=AC_MAX[t.freq])!==null&&_AC_MAX$t$freq2!==void 0?_AC_MAX$t$freq2:110:(_BC_MAX$t$freq2=BC_MAX[t.freq])!==null&&_BC_MAX$t$freq2!==void 0?_BC_MAX$t$freq2:110)+50;localMap.set(\"\".concat(t.ear,\"|\").concat(t.transducer,\"|\").concat(t.freq),{dB:t.so?overMax:t.dB});});const _getThr=(earKey,transKey,f)=>{var _localMap$get$dB,_localMap$get;return(_localMap$get$dB=(_localMap$get=localMap.get(\"\".concat(earKey,\"|\").concat(transKey,\"|\").concat(f)))===null||_localMap$get===void 0?void 0:_localMap$get.dB)!==null&&_localMap$get$dB!==void 0?_localMap$get$dB:Infinity;};const _hears=(earKey,transKey,f,L,maskedFlag,maskLvl)=>{var _IA$transKey;const teThr=_getThr(earKey,transKey,f);const testEarHeard=L>=teThr;const nte=earKey==='R'?'L':'R';const ia=(_IA$transKey=IA[transKey])!==null&&_IA$transKey!==void 0?_IA$transKey:0;const leakedToNTE=L-ia;const nteBC=_getThr(nte,'BC',f);const effectiveMask=maskedFlag&&maskLvl>nteBC?maskLvl:nteBC;const crossHeard=leakedToNTE>=effectiveMask;return testEarHeard||crossHeard;};console.assert(_hears('R','AC',1000,10,false,-15)===true,'test-ear hears >= thr');console.assert(_hears('R','AC',2000,70,true,80)===true,'effective masking keeps true via test-ear');}catch(e){console.warn('Sanity check failed:',e);}},[showLegend]);// Overlay answer (blink)\nconst[showAnswer,setShowAnswer]=useState(false);const[overMaskingWarning,setOverMaskingWarning]=useState(true);// オーバーマスキング警告のON/OFF\nconst[blinkOn,setBlinkOn]=useState(true);useEffect(()=>{if(!showAnswer)return;const id=setInterval(()=>setBlinkOn(b=>!b),700);return()=>clearInterval(id);},[showAnswer]);// Debug: log showAnswer state changes\nuseEffect(()=>{console.log('showAnswer changed:',showAnswer);},[showAnswer]);// Keyboard: Arrow keys for navigation and level control\nuseEffect(()=>{if(typeof window==='undefined')return;const onKeyDown=e=>{const el=e.target;const tag=el&&el.tagName?el.tagName.toUpperCase():'';const type=el&&el.type?String(el.type).toLowerCase():'';const isTypingField=tag==='INPUT'&&(type==='text'||type==='number'||type==='search'||type==='email'||type==='password')||tag==='TEXTAREA'||el&&el.isContentEditable===true;if(isTypingField)return;// 周波数変更（左右キー）\nif(e.key==='ArrowRight'){e.preventDefault();console.log('右キー押下');setFreq(prev=>{const idx=Math.max(0,FREQS.indexOf(prev));let nextIdx=Math.min(FREQS.length-1,idx+1);// BC測定時は125Hz/8000Hzをスキップ\nif(trans==='BC'){while(BC_DISABLED.has(FREQS[nextIdx])){nextIdx=Math.min(FREQS.length-1,nextIdx+1);if(nextIdx===FREQS.length-1)break;}}return FREQS[nextIdx];});}if(e.key==='ArrowLeft'){e.preventDefault();console.log('左キー押下');setFreq(prev=>{const idx=Math.max(0,FREQS.indexOf(prev));let nextIdx=Math.max(0,idx-1);// BC測定時は125Hz/8000Hzをスキップ\nif(trans==='BC'){while(BC_DISABLED.has(FREQS[nextIdx])){nextIdx=Math.max(0,nextIdx-1);if(nextIdx===0)break;}}return FREQS[nextIdx];});}// レベル調整（上下キー）- 上下を逆にして、自動打点\nif(e.key==='ArrowUp'){e.preventDefault();console.log('上キー押下');setLevel(prev=>{const newLevel=Math.min(Y_MAX,prev-5);// 上キーで-5dB\nsetSuppressLamp(false);// 自動で打点追加\nsetTimeout(()=>{addOrReplacePoint({ear,transducer:trans,masked,freq,dB:round5(newLevel)});},50);return newLevel;});}if(e.key==='ArrowDown'){e.preventDefault();console.log('下キー押下');setLevel(prev=>{const newLevel=Math.max(Y_MIN,prev+5);// 下キーで+5dB\nsetSuppressLamp(false);// 自動で打点追加\nsetTimeout(()=>{addOrReplacePoint({ear,transducer:trans,masked,freq,dB:round5(newLevel)});},50);return newLevel;});}// Deleteキーで現在の打点削除\nif(e.key==='Delete'||e.key==='Backspace'){e.preventDefault();removePointAtCurrent();}};window.addEventListener('keydown',onKeyDown,{capture:true});return()=>{window.removeEventListener('keydown',onKeyDown,{capture:true});};},[ear,trans,masked,freq,level]);// 周波数が変わったら一度ランプを消灯\nuseEffect(()=>{setSuppressLamp(true);},[freq]);const freqIndex=useMemo(()=>Math.max(0,FREQS.indexOf(freq)),[freq]);function moveFreq(dir/* -1 | 1 */){let idx=clamp(freqIndex+dir,0,FREQS.length-1);// BC時は125/8000Hzをスキップ\nif(trans==='BC'){while(BC_DISABLED.has(FREQS[idx])){idx=clamp(idx+dir,0,FREQS.length-1);if(idx===0||idx===FREQS.length-1)break;}}setFreq(FREQS[idx]);}// clicking on chart -> add/replace point for current ear/trans/masked+freq\nfunction addOrReplacePoint(p){if(p.transducer==='BC'&&BC_DISABLED.has(p.freq)){setSuppressLamp(true);return;}const p2=_objectSpread(_objectSpread({},p),{},{masked:p.masked});const max=maxPresentable(p2.transducer,p2.freq);const atMax=p2.dB>=max;const heardAtMax=hearsAtLevel(p2.ear,p2.transducer,p2.freq,max);const so=atMax&&!heardAtMax;const p3=_objectSpread(_objectSpread({},p2),{},{dB:atMax?max:p2.dB},so?{so:true}:{});setPoints(prev=>{const k=x=>\"\".concat(x.ear,\"|\").concat(x.transducer,\"|\").concat(x.masked?'M':'U',\"|\").concat(x.freq);const kp=k(p3);const others=prev.filter(q=>k(q)!==kp);return[...others,p3].sort((a,b)=>a.freq-b.freq||a.dB-b.dB);});setSuppressLamp(false);}// Precise hit: map overlay click to real grid using measured scale/offset\nfunction handlePlotClick(e){if(trans==='BC'&&BC_DISABLED.has(freq)){setSuppressLamp(true);return;}const ov=overlayRef.current;if(!ov)return;const ovRect=ov.getBoundingClientRect();// クリック位置をオーバーレイ内の相対座標に変換\nconst clickX=e.clientX-ovRect.left;const clickY=e.clientY-ovRect.top;// Y軸の範囲を計算（オーディオグラムは上から下に-10dBから120dB）\nconst yRange=Y_MAX-Y_MIN;// 130dB\nconst yRatio=clickY/ovRect.height;// 0から1の比率\n// RechartsのY軸はreversed=trueなので、座標変換を修正\n// 上（yRatio=0）が120dB、下（yRatio=1）が-10dB\nlet dBraw=Y_MIN+yRatio*yRange;dBraw+=CAL_OFFSET_DB;// optional small offset (kept 0 by default)\nconst dBclamped=clamp(round5(dBraw),Y_MIN,Y_MAX);const max=maxPresentable(trans,freq);const atMax=dBclamped>=max;const heardAtMax=hearsAtLevel(ear,trans,freq,max);const so=atMax&&!heardAtMax;const p=_objectSpread({ear,transducer:trans,masked,freq,dB:atMax?max:dBclamped},so?{so:true}:{});addOrReplacePoint(p);setLevel(p.dB);setSuppressLamp(false);}function removePointAtCurrent(){setPoints(prev=>prev.filter(q=>!(q.ear===ear&&q.transducer===trans&&q.freq===freq&&q.masked===masked)));}function clearAll(){setPoints([]);}// ---- Target lookup for cross-hearing & lamp logic ----\nconst targetMap=useMemo(()=>{const map=new Map();(targets||[]).forEach(t=>{var _AC_MAX$t$freq3,_BC_MAX$t$freq3;if(!t||t.masked!==false||typeof t.freq!=='number')return;const overMax=(t.transducer==='AC'?(_AC_MAX$t$freq3=AC_MAX[t.freq])!==null&&_AC_MAX$t$freq3!==void 0?_AC_MAX$t$freq3:110:(_BC_MAX$t$freq3=BC_MAX[t.freq])!==null&&_BC_MAX$t$freq3!==void 0?_BC_MAX$t$freq3:110)+50;const dB=t.so?overMax:t.dB;map.set(\"\".concat(t.ear,\"|\").concat(t.transducer,\"|\").concat(t.freq),{dB});});return map;},[targets]);// オーバーマスキング検出\nconst isOverMasking=useMemo(()=>{if(!masked||!overMaskingWarning)return false;const testEarThreshold=getThr(ear,trans,freq);if(testEarThreshold===Infinity){return false;}// マスキングの上限 = 測定耳閾値 + 50dB\nconst maskingLimit=testEarThreshold+50;// マスキングレベルが上限を超えている場合\nreturn maskLevel>maskingLimit;},[masked,maskLevel,ear,trans,freq,overMaskingWarning,targetMap]);function getThr(earKey,transKey,f){const key=\"\".concat(earKey,\"|\").concat(transKey,\"|\").concat(f);const v=targetMap.get(key);if(v&&typeof v.dB==='number'){// SO（Scale-Out）の場合は最大値+50dBを返す\nif(v.dB>=110){var _AC_MAX$f2,_BC_MAX$f2;return(transKey==='AC'?(_AC_MAX$f2=AC_MAX[f])!==null&&_AC_MAX$f2!==void 0?_AC_MAX$f2:110:(_BC_MAX$f2=BC_MAX[f])!==null&&_BC_MAX$f2!==void 0?_BC_MAX$f2:110)+50;}return v.dB;}return Infinity;// missing → treat as no response\n}function hearsAtLevel(earKey,transKey,f,L){var _IA$transKey2;const teThr=getThr(earKey,transKey,f);const testEarHeard=L>=teThr;const nte=earKey==='R'?'L':'R';const ia=(_IA$transKey2=IA[transKey])!==null&&_IA$transKey2!==void 0?_IA$transKey2:0;const leakedToNTE=L-ia;// マスキングの基本原理：\n// AC測定時：非測定耳のBC閾値と比較\n// BC測定時：非測定耳のBC閾値と比較\nconst nteBC=getThr(nte,'BC',f);// マスキングの計算\nlet effectiveMask=nteBC;if(masked&&maskLevel>nteBC){// マスキングレベルが非測定耳BC閾値より高い場合\neffectiveMask=maskLevel;}const crossHeard=leakedToNTE>=effectiveMask;return testEarHeard||crossHeard;}// series data (user)\nconst seriesData=useMemo(()=>{const m={};SERIES.forEach(s=>m[s.key]=[]);points.forEach(p=>{const key=seriesKey(p);if(!m[key])m[key]=[];const i=Math.max(0,FREQS.indexOf(p.freq));const xIdx=i;m[key].push(_objectSpread({x:xIdx,idx:i,y:p.dB},p.so?{so:true}:{}));});return m;},[points]);// AC lines (connect) — break at Scale-Out and at gaps\nconst acLineData=useMemo(()=>{const out={};SERIES.filter(s=>s.key.includes('-AC-')).forEach(s=>{out[s.key]=FREQS.map((_,i)=>({x:i,y:null}));const pts=seriesData[s.key]||[];pts.forEach(p=>{const i=p.x;if(!p||typeof i!=='number')return;out[s.key][i]=p.so?{x:i,y:null}:{x:i,y:p.y};});});return out;},[seriesData]);// Build answer overlay series from loaded targets (markers)\nconst answerSeriesData=useMemo(()=>{const m={};SERIES.forEach(s=>m[s.key]=[]);(targets||[]).forEach(t=>{var _AC_MAX$t$freq4,_BC_MAX$t$freq4;if(t.transducer==='BC'&&BC_DISABLED.has(t.freq))return;const i=Math.max(0,FREQS.indexOf(t.freq));const xIdx=i;const isSO=!!t.so;const yVal=isSO?t.transducer==='AC'?(_AC_MAX$t$freq4=AC_MAX[t.freq])!==null&&_AC_MAX$t$freq4!==void 0?_AC_MAX$t$freq4:110:(_BC_MAX$t$freq4=BC_MAX[t.freq])!==null&&_BC_MAX$t$freq4!==void 0?_BC_MAX$t$freq4:110:t.dB;// BCの場合は常にmaskedのキーを使用\nconst key=t.transducer==='BC'?\"\".concat(t.ear,\"-\").concat(t.transducer,\"-M\"):\"\".concat(t.ear,\"-\").concat(t.transducer,\"-\").concat(t.masked?'M':'U');m[key]=m[key]||[];m[key].push(_objectSpread({x:xIdx,y:yVal},isSO?{so:true}:{}));});console.log('answerSeriesData generated:',m);return m;},[targets]);// Answer AC lines: break at SO and at gaps by inserting null placeholders\nconst answerLineData=useMemo(()=>{const out={};SERIES.filter(s=>s.key.includes('-AC-')).forEach(s=>{out[s.key]=FREQS.map((_,i)=>({x:i,y:null}));const pts=answerSeriesData[s.key]||[];pts.forEach(p=>{const i=p.x;if(!p||typeof i!=='number')return;out[s.key][i]=p.so?{x:i,y:null}:{x:i,y:p.y};});});return out;},[answerSeriesData]);// Response lamp (current condition vs target >= OR cross-hearing)\nconst currentTarget=useMemo(()=>(targets||[]).find(x=>x.ear===ear&&x.transducer===trans&&x.masked===false&&x.freq===freq),[targets,ear,trans,freq]);const lampOn=useMemo(()=>{if(!currentTarget)return false;if(suppressLamp)return false;// 抑制中は消灯\nconst L=round5(level);// クロスヒアリングを考慮した応答判定\nreturn hearsAtLevel(ear,trans,freq,L);},[currentTarget,level,ear,trans,freq,masked,maskLevel,targetMap,suppressLamp]);// オーバーマスキングを考慮した実際の閾値を取得\nfunction getActualThreshold(earKey,transKey,f){const baseThreshold=getThr(earKey,transKey,f);if(masked&&transKey==='BC'){// BC測定時のオーバーマスキング計算\n// マスキングの上限 = 測定耳BC閾値 + 50dB\nconst maskingLimit=baseThreshold+50;if(maskLevel>maskingLimit){// オーバーマスキング発生\nconst overMasking=maskLevel-maskingLimit;return baseThreshold+overMasking;}}return baseThreshold;}// パスワード認証画面\nif(!isAuthenticated){return/*#__PURE__*/_jsx(\"div\",{className:\"w-full min-h-screen flex items-center justify-center bg-gray-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full mx-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"\\u30AA\\u30FC\\u30C7\\u30A3\\u30AA\\u30B0\\u30E9\\u30E0\\u8B1B\\u7FD2\\u4F1A\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"\\u53C2\\u52A0\\u7528\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\\u3092\\u5165\\u529B\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),onKeyPress:e=>e.key==='Enter'&&password===TRAINING_PASSWORD&&setIsAuthenticated(true),className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"\\u8B1B\\u7FD2\\u4F1A\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>password===TRAINING_PASSWORD&&setIsAuthenticated(true),disabled:password!==TRAINING_PASSWORD,className:\"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\",children:\"\\u53C2\\u52A0\\u3059\\u308B\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center text-sm text-gray-500\",children:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9: audiogram2024\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"w-full min-h-screen p-6 md:p-10 bg-gray-50 text-gray-900\",ref:containerRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto grid gap-6\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"flex flex-col md:flex-row md:items-end md:justify-between gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl md:text-3xl font-bold\",children:\"Simple Audiogram builder (Masking simulator)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mt-1\",children:\"\\u8B1B\\u7FD2\\u4F1A\\u53C2\\u52A0\\u4E2D - \\u8B1B\\u5E2B\\u306E\\u6307\\u793A\\u306B\\u5F93\\u3063\\u3066\\u64CD\\u4F5C\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsAuthenticated(false),className:\"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300\",children:\"\\u9000\\u51FA\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-50 border border-blue-200 rounded-2xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-blue-600 text-xl\",children:\"\\uD83D\\uDCDA\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-blue-800\",children:\"\\u8B1B\\u7FD2\\u4F1A\\u53C2\\u52A0\\u8005\\u306E\\u65B9\\u3078\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-700 mt-1\",children:[\"\\u2022 \\u8B1B\\u5E2B\\u306E\\u6307\\u793A\\u306B\\u5F93\\u3063\\u3066\\u75C7\\u4F8B\\u3092\\u9078\\u629E\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 \\u5404\\u81EA\\u3067\\u64CD\\u4F5C\\u3057\\u306A\\u304C\\u3089\\u5B66\\u7FD2\\u3092\\u9032\\u3081\\u3066\\u304F\\u3060\\u3055\\u3044\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 \\u8CEA\\u554F\\u304C\\u3042\\u308B\\u5834\\u5408\\u306F\\u30C1\\u30E3\\u30C3\\u30C8\\u3067\\u304A\\u805E\\u304D\\u304F\\u3060\\u3055\\u3044\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 \\u6B63\\u7B54\\u8868\\u793A\\u306F\\u8B1B\\u5E2B\\u306E\\u6307\\u793A\\u304C\\u3042\\u308B\\u307E\\u3067\\u5F85\\u3063\\u3066\\u304F\\u3060\\u3055\\u3044\"]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-50 border border-green-200 rounded-2xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-green-600 text-xl\",children:\"\\u2328\\uFE0F\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-green-800\",children:\"\\u30AD\\u30FC\\u30DC\\u30FC\\u30C9\\u64CD\\u4F5C\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-green-700 mt-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u30AB\\u30FC\\u30BD\\u30EB\\u30AD\\u30FC:\"}),\" \\u2190\\u2192\\u5468\\u6CE2\\u6570\\u5909\\u66F4 | \\u2191-5dB\\u8ABF\\u6574(\\u81EA\\u52D5\\u6253\\u70B9) | \\u2193+5dB\\u8ABF\\u6574(\\u81EA\\u52D5\\u6253\\u70B9)\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"\\u524A\\u9664:\"}),\" Delete\\u30AD\\u30FC\\u307E\\u305F\\u306FBackspace\\u30AD\\u30FC\\u3067\\u73FE\\u5728\\u306E\\u6253\\u70B9\\u524A\\u9664\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"\\u30DE\\u30A6\\u30B9:\"}),\" \\u30C1\\u30E3\\u30FC\\u30C8\\u30AF\\u30EA\\u30C3\\u30AF\\u3067\\u3082\\u6253\\u70B9\\u53EF\\u80FD\"]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-2xl shadow p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"\\u75C7\\u4F8B\\u30D7\\u30EA\\u30BB\\u30C3\\u30C8\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border rounded-xl px-2 py-1 text-sm\",value:selectedPreset,onChange:e=>setSelectedPreset(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"A\",children:\"\\u75C7\\u4F8BA\"}),/*#__PURE__*/_jsx(\"option\",{value:\"B\",children:\"\\u75C7\\u4F8BB\"}),/*#__PURE__*/_jsx(\"option\",{value:\"C\",children:\"\\u75C7\\u4F8BC\"}),/*#__PURE__*/_jsx(\"option\",{value:\"D\",children:\"\\u75C7\\u4F8BD\"}),/*#__PURE__*/_jsx(\"option\",{value:\"E\",children:\"\\u75C7\\u4F8BE\"}),/*#__PURE__*/_jsx(\"option\",{value:\"F\",children:\"\\u75C7\\u4F8BF\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-2 rounded-xl bg-teal-600 text-white text-sm\",onClick:()=>{const p=selectedPreset==='A'?PRESET_A:selectedPreset==='B'?PRESET_B:selectedPreset==='C'?PRESET_C:selectedPreset==='D'?PRESET_D:selectedPreset==='E'?PRESET_E:PRESET_F;setPoints([]);setTargets(buildTargetsFromPreset(p));},children:\"LOAD\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-400\",children:\"\\u203B LOAD\\u3067\\u30D7\\u30ED\\u30C3\\u30C8\\u306F\\u81EA\\u52D5\\u30AF\\u30EA\\u30A2\\u3002\\u6B63\\u7B54\\u306F\\u753B\\u9762\\u306B\\u8868\\u793A\\u3057\\u307E\\u305B\\u3093\\uFF08\\u7167\\u5408/\\u30AA\\u30FC\\u30D0\\u30FC\\u30EC\\u30A4\\u7528\\uFF09\\u3002\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow p-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid md:grid-cols-6 gap-4 text-sm\",children:[/*#__PURE__*/_jsx(Control,{label:\"Ear\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEar('R');setFreq(1000);setSuppressLamp(true);},className:\"px-3 py-2 rounded-lg border text-base \".concat(ear==='R'?'bg-red-600 text-white border-red-600':'bg-white text-red-600 border-red-600'),children:\"Right\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEar('L');setFreq(1000);setSuppressLamp(true);},className:\"px-3 py-2 rounded-lg border text-base \".concat(ear==='L'?'bg-blue-600 text-white border-blue-600':'bg-white text-blue-600 border-blue-600'),children:\"Left\"})]})}),/*#__PURE__*/_jsx(Control,{label:\"Transducer\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(TinyToggle,{active:trans==='AC',onClick:()=>{setTrans('AC');setFreq(1000);setSuppressLamp(true);},children:\"AC\"}),/*#__PURE__*/_jsx(TinyToggle,{active:trans==='BC',onClick:()=>{setTrans('BC');setFreq(1000);setSuppressLamp(true);},children:\"BC\"})]})}),/*#__PURE__*/_jsx(Control,{label:\"Frequency\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>moveFreq(-1),className:\"px-2 py-1 rounded-lg border\",children:\"\\u25C0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-mono w-24 text-center\",children:[freq,\" Hz\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>moveFreq(1),className:\"px-2 py-1 rounded-lg border\",children:\"\\u25B6\"})]})}),/*#__PURE__*/_jsx(Control,{label:\"Level (dB HL)\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:Y_MIN,max:Y_MAX,step:5,value:level,onChange:e=>{setLevel(parseInt(e.target.value));setSuppressLamp(false);},className:\"w-full\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-mono w-16 text-right\",children:level})]})}),/*#__PURE__*/_jsx(Control,{label:\"\\u6253\\u70B9\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>addOrReplacePoint({ear,transducer:trans,masked,freq,dB:round5(level)}),className:\"px-3 py-2 rounded-xl bg-indigo-600 text-white\",children:\"\\u8FFD\\u52A0/\\u66F4\\u65B0\"}),/*#__PURE__*/_jsx(\"button\",{onClick:removePointAtCurrent,className:\"px-3 py-2 rounded-xl bg-white border\",children:\"\\u524A\\u9664\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearAll,className:\"px-3 py-2 rounded-xl bg-white border\",children:\"\\u5168\\u30AF\\u30EA\\u30A2\"})]})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-2\",children:[\"\\u203B \\u30C1\\u30E3\\u30FC\\u30C8\\u3092\\u30AF\\u30EA\\u30C3\\u30AF\\u3057\\u3066\\u3082\\u6253\\u70B9\\u3067\\u304D\\u307E\\u3059\\uFF08\\u73FE\\u5728\\u9078\\u629E\\u4E2D\\u306EEar/Transducer/Masking\\u30FB\\u5468\\u6CE2\\u6570\\u5217\\u306B\\u5BFE\\u3057\\u3066\\uFF09\\u3002\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u203B \\u30AD\\u30FC\\u30DC\\u30FC\\u30C9\\u64CD\\u4F5C: \\u2190\\u2192\\u5468\\u6CE2\\u6570\\u5909\\u66F4 | \\u2191-5dB\\u8ABF\\u6574(\\u81EA\\u52D5\\u6253\\u70B9) | \\u2193+5dB\\u8ABF\\u6574(\\u81EA\\u52D5\\u6253\\u70B9) | Delete\\u6253\\u70B9\\u524A\\u9664\"]})]}),isOverMasking&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-2xl p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-red-600 text-xl\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-red-800\",children:\"\\u30AA\\u30FC\\u30D0\\u30FC\\u30DE\\u30B9\\u30AD\\u30F3\\u30B0\\u306E\\u53EF\\u80FD\\u6027\\u3042\\u308A\\uFF01\\uFF01\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl shadow p-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold\",children:\"Audiogram\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 px-2 py-1 rounded-full border \".concat(lampOn?'bg-orange-50 border-orange-300':'bg-white border-gray-300'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3.5 h-3.5 rounded-full \".concat(lampOn?'bg-orange-500':'bg-gray-300')}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs\",children:\"\\u5FDC\\u7B54\\u30E9\\u30F3\\u30D7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-600\",children:[\"Masking (NTE: \",ear==='R'?'L':'R',\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(TinyToggle,{active:!masked,onClick:()=>{setMasked(false);setMaskLevel(-15);},children:\"Unmasked\"}),/*#__PURE__*/_jsx(TinyToggle,{active:masked,onClick:()=>{setMasked(true);if(maskLevel<0)setMaskLevel(0);},children:\"Masked\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 min-w-[180px]\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:-15,max:110,step:5,value:maskLevel,onChange:e=>setMaskLevel(parseInt(e.target.value)),className:\"w-40\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-16 text-right text-xs font-mono\",children:[maskLevel,\" dB\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowAnswer(a=>!a),className:\"px-2 py-1 rounded-lg border text-xs \".concat(showAnswer?'bg-emerald-600 text-white border-emerald-600':'bg-white text-gray-800'),title:\"\\u6B63\\u7B54\\uFF08\\u30AA\\u30FC\\u30D0\\u30FC\\u30EC\\u30A4\\uFF09\\u3092\\u8868\\u793A/\\u975E\\u8868\\u793A\",children:showAnswer?'正答表示: ON':'正答表示: OFF'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setOverMaskingWarning(w=>!w),className:\"px-2 py-1 rounded-lg border text-xs \".concat(overMaskingWarning?'bg-yellow-600 text-white border-yellow-600':'bg-white text-gray-800'),title:\"\\u30AA\\u30FC\\u30D0\\u30FC\\u30DE\\u30B9\\u30AD\\u30F3\\u30B0\\u8B66\\u544A\\u306EON/OFF\",children:overMaskingWarning?'警告: ON':'警告: OFF'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-stretch gap-0 items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{ref:chartHostRef,className:\"relative chart-host\",style:{width:chartW,height:chartH,overflow:'visible'},children:[/*#__PURE__*/_jsx(\"div\",{ref:overlayRef,className:\"absolute\",style:{left:CHART_MARGIN.left,top:CHART_MARGIN.top,width:GRID_W,height:GRID_H,cursor:'crosshair',zIndex:10,pointerEvents:'auto',background:'transparent'},onPointerUp:handlePlotClick,onPointerDown:e=>e.preventDefault()}),/*#__PURE__*/_jsxs(ComposedChart,{width:chartW,height:chartH,data:[],margin:CHART_MARGIN,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{type:\"number\",dataKey:\"x\",domain:X_DOMAIN,ticks:Array.from({length:FREQS.length},(_,i)=>i),tickFormatter:formatFreq,label:{value:'Frequency (Hz) - 1 octave/grid',position:'bottom',offset:6,style:{fontSize:18}},tick:{fontSize:18}}),/*#__PURE__*/_jsx(YAxis,{type:\"number\",dataKey:\"y\",domain:[Y_MIN,Y_MAX],ticks:Array.from({length:(Y_MAX-Y_MIN)/10+1},(_,i)=>Y_MIN+i*10),reversed:true,tickMargin:6,label:{value:'Hearing Level (dB HL) - 10 dB/grid',angle:-90,position:'left',offset:0,dy:-100,style:{fontSize:18}},tick:{fontSize:18}}),/*#__PURE__*/_jsx(Line,{data:[{x:0,y:0},{x:FREQS.length-1,y:0}],dataKey:\"y\",xAxisId:0,yAxisId:0,type:\"monotone\",dot:false,stroke:\"#94a3b8\",strokeWidth:2}),SERIES.map(s=>/*#__PURE__*/_jsx(Scatter,{name:s.label,data:(seriesData[s.key]||[]).map(d=>_objectSpread({x:d.x,y:d.y},d.so?{so:true}:{})),fill:s.color,shape:shapeRenderer(s.shape,s.color)},s.key)),SERIES.filter(s=>s.key.includes('-AC-')).map(s=>/*#__PURE__*/_jsx(Line,{data:acLineData[s.key]||[],dataKey:\"y\",stroke:s.color,strokeWidth:2,dot:false,strokeDasharray:s.key.startsWith('L-')?'6 4':undefined,type:\"linear\",connectNulls:false},\"line-\".concat(s.key))),showAnswer&&SERIES.map(s=>/*#__PURE__*/_jsx(Scatter,{name:\"\".concat(s.label,\" (answer)\"),data:answerSeriesData[s.key]||[],fill:\"#10b981\",shape:props=>/*#__PURE__*/_jsx(\"g\",{style:{opacity:blinkOn?1:0},children:shapeRenderer(s.shape,'#10b981')(props)}),isAnimationActive:false},\"ans-\".concat(s.key))),showAnswer&&SERIES.filter(s=>s.key.includes('-AC-')).map(s=>/*#__PURE__*/_jsx(Line,{data:answerLineData[s.key]||[],dataKey:\"y\",stroke:\"#10b981\",strokeOpacity:0.35,isAnimationActive:false,strokeWidth:2,dot:false,strokeDasharray:'4 6',type:\"linear\",connectNulls:false},\"ans-line-\".concat(s.key)))]})]}),showLegend&&/*#__PURE__*/_jsx(\"div\",{className:\"shrink-0 pl-2\",style:{display:'flex',alignItems:'flex-start'},children:/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-0.5 text-[16px] leading-tight pr-1\",children:SERIES.map(s=>/*#__PURE__*/_jsxs(\"li\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(LegendMark,{shape:s.shape,color:s.color}),/*#__PURE__*/_jsx(\"span\",{children:s.label})]},s.key))})})]})]})]})});}// small UI helpers\nfunction Control(_ref3){let{label,children}=_ref3;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-700 mb-1 text-base\",children:label}),children]});}function TinyToggle(_ref4){let{active,onClick,children}=_ref4;return/*#__PURE__*/_jsx(\"button\",{onClick:onClick,className:\"px-3 py-2 rounded-lg border text-base \".concat(active?'bg-black text-white border-black':'bg-white text-gray-800'),children:children});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","useLayoutEffect","ResponsiveContainer","ComposedChart","XAxis","YAxis","CartesianGrid","Scatter","Line","jsx","_jsx","jsxs","_jsxs","CAL_OFFSET_DB","BC_DISABLED","Set","FREQS","X_DOMAIN","length","Y_MIN","Y_MAX","CHART_SCALE","CELL_PX","GRID_W","GRID_H","AXIS_LEFT","AXIS_RIGHT","AXIS_TOP","AXIS_BOTTOM","CHART_MARGIN","top","right","bottom","left","IA","AC","BC","AC_MAX","BC_MAX","MARK_R","MARK_STROKE","formatFreq","v","i","Math","round","String","SERIES","key","label","color","shape","mk","ear","transducer","list","map","_ref","freq","dB","so","_objectSpread","masked","preset","name","parts","targets","flat","PRESET_A","PRESET_B","PRESET_C","PRESET_D","PRESET_E","PRESET_F","buildTargetsFromPreset","t","clamp","n","lo","hi","max","min","round5","seriesKey","p","concat","isResponse","points","some","maxPresentable","transKey","f","_AC_MAX$f","_BC_MAX$f","shapeRenderer","props","cx","cy","payload","r","Arrow","children","x1","y1","x2","y2","stroke","strokeWidth","fill","lbracketOffset","rbracketOffset","ltOffset","gtOffset","LegendMark","_ref2","size","render","width","height","viewBox","transform","AudiogramMaskingMVP","isAuthenticated","setIsAuthenticated","password","setPassword","TRAINING_PASSWORD","setEar","trans","setTrans","setMasked","setFreq","maskLevel","setMaskLevel","level","setLevel","setPoints","suppressLamp","setSuppressLamp","showLegend","setShowLegend","setTargets","selectedPreset","setSelectedPreset","containerRef","chartHostRef","overlayRef","plotCalRef","scaleY","deltaTop","chartW","chartH","host","current","ov","gridG","querySelector","getBoundingClientRect","gridRect","ovRect","_tmap$get","console","assert","Array","isArray","every","s","sampleTicks","from","_","tmap","Map","filter","forEach","_AC_MAX$t$freq","_BC_MAX$t$freq","base","set","k","get","Number","isFinite","getThr","yMin","yMax","gridH","mapYToDb","y","assertNear5","val","expect","abs","localMap","_AC_MAX$t$freq2","_BC_MAX$t$freq2","overMax","_getThr","earKey","_localMap$get$dB","_localMap$get","Infinity","_hears","L","maskedFlag","maskLvl","_IA$transKey","teThr","testEarHeard","nte","ia","leakedToNTE","nteBC","effectiveMask","crossHeard","e","warn","showAnswer","setShowAnswer","overMaskingWarning","setOverMaskingWarning","blinkOn","setBlinkOn","id","setInterval","b","clearInterval","log","window","onKeyDown","el","target","tag","tagName","toUpperCase","type","toLowerCase","isTypingField","isContentEditable","preventDefault","prev","idx","indexOf","nextIdx","has","newLevel","setTimeout","addOrReplacePoint","removePointAtCurrent","addEventListener","capture","removeEventListener","freqIndex","moveFreq","dir","p2","atMax","heardAtMax","hearsAtLevel","p3","x","kp","others","q","sort","a","handlePlotClick","clickX","clientX","clickY","clientY","yRange","yRatio","dBraw","dBclamped","clearAll","targetMap","_AC_MAX$t$freq3","_BC_MAX$t$freq3","isOverMasking","testEarThreshold","maskingLimit","_AC_MAX$f2","_BC_MAX$f2","_IA$transKey2","seriesData","m","xIdx","push","acLineData","out","includes","pts","answerSeriesData","_AC_MAX$t$freq4","_BC_MAX$t$freq4","isSO","yVal","answerLineData","currentTarget","find","lampOn","getActualThreshold","baseThreshold","overMasking","className","value","onChange","onKeyPress","placeholder","onClick","disabled","ref","Control","TinyToggle","active","step","parseInt","title","w","style","overflow","cursor","zIndex","pointerEvents","background","onPointerUp","onPointerDown","data","margin","strokeDasharray","dataKey","domain","ticks","tickFormatter","position","offset","fontSize","tick","reversed","tickMargin","angle","dy","xAxisId","yAxisId","dot","d","startsWith","undefined","connectNulls","opacity","isAnimationActive","strokeOpacity","display","alignItems","_ref3","_ref4"],"sources":["/Users/maedahidehiko/Documents/myAudiogram builder/src/AudiogramMaskingMVP.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useRef, useLayoutEffect } from \"react\";\nimport { ResponsiveContainer, ComposedChart, XAxis, YAxis, CartesianGrid, Scatter, Line } from \"recharts\";\n\n// Audiogram-first Masking Trainer (MVP v2.4.9)\n// - 1oct/grid x 10dB ticks; 1oct == 20dB; AC O/X, BC </> []\n// - Overlay blink; legend right-side panel; masking slider in header\n// - Fix: add targetMap + getThr() → resolves \"getThr is not defined\"\n\n// --- constants ---\n// Optional click→dB calibration offset (kept 0 as per spec 1/2/3)\nconst CAL_OFFSET_DB = 0;\nconst BC_DISABLED = new Set([125, 8000]); // BCは125Hz/8000Hzは測定対象外\nconst FREQS = [125, 250, 500, 1000, 2000, 4000, 8000]; // 7 points -> 6 octaves\n// Slight domain padding to prevent edge clipping without changing visible tick positions\nconst X_DOMAIN = [0, FREQS.length - 1];\nconst Y_MIN = -10;  // dB HL (top small, bottom large)\nconst Y_MAX = 120;  // 10 dB ticks (render squares use 20 dB cells)\nconst CHART_SCALE = 1;\n// Geometry to force 1 octave (X) == 20 dB (Y)\nconst CELL_PX = 100; // px per 1 octave (== 20 dB) — larger, keeps square cells\nconst GRID_W = CELL_PX * (FREQS.length - 1); // 6 octaves\nconst GRID_H = CELL_PX * ((Y_MAX - Y_MIN) / 20); // vertical cells of 20 dB\nconst AXIS_LEFT = 64, AXIS_RIGHT = 40, AXIS_TOP = 20, AXIS_BOTTOM = 48; // increase top to avoid clipping -10 dB tick\nconst CHART_MARGIN = { top: AXIS_TOP, right: AXIS_RIGHT, bottom: AXIS_BOTTOM, left: AXIS_LEFT }; // plotting box = GRID_W x GRID_H\n\n// Interaural Attenuation (IA): AC=50 dB, BC=0 dB\nconst IA = { AC: 50, BC: 0 };\n\n// Max presentable levels (for Scale-Out logic)\nconst AC_MAX = { 125: 70, 250: 90, 500: 110, 1000: 110, 2000: 110, 4000: 110, 8000: 100 };\nconst BC_MAX = { 250: 55, 500: 65, 1000: 70, 2000: 70, 4000: 60 };\n\n// Marker size for AC/BC symbols (px). 24px target → radius 12, thicker stroke.\nconst MARK_R = 8; // radius (smaller markers)\nconst MARK_STROKE = 2;\n\n// Safe tick formatter for X axis (1 octave grid labels)\nfunction formatFreq(v) {\n  const i = Math.round(typeof v === 'number' ? v : 0);\n  return String((FREQS && FREQS[i] != null) ? FREQS[i] : \"\");\n}\n\n// Legend / rendering series\nconst SERIES = [\n  { key: \"R-AC-U\", label: \"Right AC (unmasked)\", color: \"#ef4444\", shape: \"O\" },\n  { key: \"R-AC-M\", label: \"Right AC (masked)\",   color: \"#b91c1c\", shape: \"O\" },\n  { key: \"L-AC-U\", label: \"Left  AC (unmasked)\",  color: \"#3b82f6\", shape: \"X\" },\n  { key: \"L-AC-M\", label: \"Left  AC (masked)\",    color: \"#1d4ed8\", shape: \"X\" },\n  { key: \"R-BC-U\", label: \"Right BC (unmasked)\", color: \"#ef4444\", shape: \"lt\" },\n  { key: \"R-BC-M\", label: \"Right BC (masked)\",   color: \"#b91c1c\", shape: \"lbracket\" },\n  { key: \"L-BC-U\", label: \"Left  BC (unmasked)\",  color: \"#3b82f6\", shape: \"gt\" },\n  { key: \"L-BC-M\", label: \"Left  BC (masked)\",    color: \"#1d4ed8\", shape: \"rbracket\" },\n];\n\n// --- preset helpers (compress verbose targets to keep file small) --- (compress verbose targets to keep file small) ---\nconst mk = (ear, transducer, list) =>\n  list.map(([freq, dB, so=false]) => ({ ear, transducer, masked:false, freq, dB, ...(so?{so:true}:{}) }));\nconst preset = (name, parts) => ({ name, targets: parts.flat() });\n\n// --- Preset cases (targets kept \"secret\"; used for overlay/validation only) ---\n// Each target: { ear:'R'|'L', transducer:'AC'|'BC', masked:false, freq:number, dB:number, so?:true }\nconst PRESET_A = preset('症例A', [\n  mk('R','AC', [[125,5],[250,5],[500,5],[1000,5],[2000,5],[4000,0],[8000,0]]),\n  mk('L','AC', [[125,10],[250,10],[500,5],[1000,5],[2000,5],[4000,0],[8000,-5]]),\n  mk('R','BC', [[250,5],[500,10],[1000,5],[2000,5],[4000,-5]]),\n  mk('L','BC', [[250,5],[500,5],[1000,0],[2000,5],[4000,0]])\n]);\n\nconst PRESET_B = preset('症例B', [\n  // Right AC / BC\n  mk('R','AC', [[125,10],[500,30],[1000,50],[2000,70],[4000,90],[8000,100]]),\n  mk('R','BC', [[500,30],[1000,50],[2000,70],[4000,90]]),\n  // Left AC / BC\n  mk('L','AC', [[125,15],[250,15],[500,10],[1000,10],[2000,5],[4000,5],[8000,10]]),\n  mk('L','BC', [[250,15],[500,10],[1000,10],[2000,5],[4000,5]])\n]);\n\nconst PRESET_C = preset('症例C', [\n  // Right AC / BC\n  mk('R','AC', [[125,20],[250,20],[500,15],[1000,10],[2000,10],[4000,5],[8000,5]]),\n  mk('R','BC', [[250,15],[500,15],[1000,10],[2000,5],[4000,10]]),\n  // Left AC/BC (SO)\n  mk('L','AC', [[125,110,true],[250,110,true],[500,110,true],[1000,110,true],[2000,110,true],[4000,110,true],[8000,110,true]]),\n  mk('L','BC', [[250,110,true],[500,110,true],[1000,110,true],[2000,110,true],[4000,110,true]])\n]);\n\nconst PRESET_D = preset('症例D', [\n  // Right AC / BC - 高音域の聴力低下\n  mk('R','AC', [[125,5],[250,5],[500,5],[1000,10],[2000,25],[4000,45],[8000,65]]),\n  mk('R','BC', [[250,5],[500,5],[1000,10],[2000,20],[4000,35]]),\n  // Left AC / BC - 低音域の聴力低下\n  mk('L','AC', [[125,25],[250,30],[500,20],[1000,10],[2000,5],[4000,5],[8000,10]]),\n  mk('L','BC', [[250,25],[500,20],[1000,10],[2000,5],[4000,5]])\n]);\n\nconst PRESET_E = preset('症例E', [\n  // Right AC / BC - 混合性難聴パターン\n  mk('R','AC', [[125,15],[250,20],[500,20],[1000,30],[2000,35],[4000,35],[8000,45]]),\n  mk('R','BC', [[250,15],[500,20],[1000,25],[2000,30],[4000,35]]),\n  // Left AC / BC - 感音性難聴パターン\n  mk('L','AC', [[125,40],[250,45],[500,40],[1000,55],[2000,60],[4000,60],[8000,70]]),\n  mk('L','BC', [[250,40],[500,45],[1000,50],[2000,55],[4000,60]])\n]);\n\nconst PRESET_F = preset('症例F', [\n  // Right AC / BC - 感音難聴（高音漸傾型）\n  mk('R','AC', [[125,10],[250,15],[500,20],[1000,30],[2000,45],[4000,65],[8000,80]]),\n  mk('R','BC', [[250,15],[500,20],[1000,30],[2000,45],[4000,65]]),\n  // Left AC / BC - 感音難聴（高音漸傾型、左右同じ）\n  mk('L','AC', [[125,10],[250,15],[500,20],[1000,30],[2000,45],[4000,65],[8000,80]]),\n  mk('L','BC', [[250,15],[500,20],[1000,30],[2000,45],[4000,65]])\n]);\n\nfunction buildTargetsFromPreset(preset){\n  return preset.targets.map(t => ({...t}));\n}\n\n// helpers\nfunction clamp(n, lo, hi) { return Math.max(lo, Math.min(hi, n)); }\nfunction round5(n) { return Math.round(n / 5) * 5; }\nfunction seriesKey(p) { return `${p.ear}-${p.transducer}-${p.masked ? \"M\" : \"U\"}`; }\nfunction isResponse(points, t) {\n  return points.some(p => p.ear===t.ear && p.transducer===t.transducer && p.masked===t.masked && p.freq===t.freq && p.dB >= t.dB);\n}\n// PRESENTATION LIMIT (fix for ReferenceError: maxPresentable is not defined)\nfunction maxPresentable(transKey, f) {\n  return transKey === 'AC' ? (AC_MAX[f] ?? 110) : (BC_MAX[f] ?? 110);\n}\n\n// shape renderer (adds SO arrow if payload.so)\nfunction shapeRenderer(shape, color) {\n  return (props) => {\n    const { cx, cy, payload } = props;\n    const r = MARK_R;\n    const t = MARK_STROKE;\n    const so = payload && payload.so;\n    const Arrow = so ? (\n      <g>\n        <line x1={cx} y1={cy + r + 2} x2={cx} y2={cy + r + 10} stroke={color} strokeWidth={t} />\n        <line x1={cx - 4} y1={cy + r + 6} x2={cx} y2={cy + r + 10} stroke={color} strokeWidth={t} />\n        <line x1={cx + 4} y1={cy + r + 6} x2={cx} y2={cy + r + 10} stroke={color} strokeWidth={t} />\n      </g>\n    ) : null;\n\n    switch (shape) {\n      case 'O':\n        return (\n          <g>\n            <circle cx={cx} cy={cy} r={r} stroke={color} strokeWidth={t} fill=\"white\" />\n            {Arrow}\n          </g>\n        );\n      case 'X':\n        return (\n          <g stroke={color} strokeWidth={t}>\n            <line x1={cx - r} y1={cy - r} x2={cx + r} y2={cy + r} />\n            <line x1={cx - r} y1={cy + r} x2={cx + r} y2={cy - r} />\n            {Arrow}\n          </g>\n        );\n      case 'lbracket': // [ (masked BC Right) - 左にずらす\n        const lbracketOffset = -3; // 右耳BCを左に3pxずらす\n        return (\n          <g stroke={color} strokeWidth={t} fill=\"none\">\n            <line x1={cx - r + lbracketOffset} y1={cy - r} x2={cx - r + lbracketOffset} y2={cy + r} />\n            <line x1={cx - r + lbracketOffset} y1={cy - r} x2={cx - r/3 + lbracketOffset} y2={cy - r} />\n            <line x1={cx - r + lbracketOffset} y1={cy + r} x2={cx - r/3 + lbracketOffset} y2={cy + r} />\n            {Arrow}\n          </g>\n        );\n      case 'rbracket': // ] (masked BC Left) - 右にずらす\n        const rbracketOffset = 3; // 左耳BCを右に3pxずらす\n        return (\n          <g stroke={color} strokeWidth={t} fill=\"none\">\n            <line x1={cx + r + rbracketOffset} y1={cy - r} x2={cx + r + rbracketOffset} y2={cy + r} />\n            <line x1={cx + r + rbracketOffset} y1={cy - r} x2={cx + r/3 + rbracketOffset} y2={cy - r} />\n            <line x1={cx + r + rbracketOffset} y1={cy + r} x2={cx + r/3 + rbracketOffset} y2={cy + r} />\n            {Arrow}\n          </g>\n        );\n      case 'lt': // < (unmasked BC Right) - 左にずらす\n        const ltOffset = -3; // 右耳BCを左に3pxずらす\n        return (\n          <g stroke={color} strokeWidth={t} fill=\"none\">\n            <line x1={cx + r + ltOffset} y1={cy - r} x2={cx - r/3 + ltOffset} y2={cy} />\n            <line x1={cx + r + ltOffset} y1={cy + r} x2={cx - r/3 + ltOffset} y2={cy} />\n            {Arrow}\n          </g>\n        );\n      case 'gt': // > (unmasked BC Left) - 右にずらす\n        const gtOffset = 3; // 左耳BCを右に3pxずらす\n        return (\n          <g stroke={color} strokeWidth={t} fill=\"none\">\n            <line x1={cx - r + gtOffset} y1={cy - r} x2={cx + r/3 + gtOffset} y2={cy} />\n            <line x1={cx - r + gtOffset} y1={cy + r} x2={cx + r/3 + gtOffset} y2={cy} />\n            {Arrow}\n          </g>\n        );\n      default:\n        return <circle cx={cx} cy={cy} r={r} fill={color} />;\n    }\n  };\n}\n\n// Legend icon that reuses chart shapes instead of color squares\nfunction LegendMark({ shape, color }) {\n  const size = MARK_R * 2 + 8; // padding around the symbol\n  const render = shapeRenderer(shape, color);\n  return (\n    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} aria-hidden>\n      <g transform={`translate(${size/2}, ${size/2})`}>\n        {render({ cx: 0, cy: 0, payload: {} })}\n      </g>\n    </svg>\n  );\n}\n\nexport default function AudiogramMaskingMVP() {\n  // 講習会用パスワード保護\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [password, setPassword] = useState('');\n  const TRAINING_PASSWORD = 'audiogram2024'; // 講習会用パスワード\n\n  // Basic UI state\n  const [ear, setEar] = useState('R'); // 'R' | 'L'\n  const [trans, setTrans] = useState('AC'); // 'AC' | 'BC'\n  const [masked, setMasked] = useState(false);\n  const [freq, setFreq] = useState(1000);\n  const [maskLevel, setMaskLevel] = useState(-15); // masking amount (dB); -15 means no masking\n  const [level, setLevel] = useState(30);\n  const [points, setPoints] = useState([]);\n  const [suppressLamp, setSuppressLamp] = useState(false); // 周波数切替時に一時的にランプ消灯\n  const [showLegend, setShowLegend] = useState(true); // ← FIX: define showLegend state\n\n  // Preset targets (secret answer)\n  const [targets, setTargets] = useState([]);\n  const [selectedPreset, setSelectedPreset] = useState('A');\n\n  // Refs / layout\n  const containerRef = useRef(null);\n  const chartHostRef = useRef(null);\n  const overlayRef = useRef(null);\n  const plotCalRef = useRef({ scaleY: 1, deltaTop: 0 });\n  // Fixed-size chart: plotting area derived from CELL_PX and margins (no ResponsiveContainer)\n  const chartW = GRID_W + AXIS_LEFT + AXIS_RIGHT; // widened right margin to avoid 8000 label clipping\n  const chartH = GRID_H + AXIS_TOP + AXIS_BOTTOM;\n\n  // Auto-hide legend if plotting box is too small (safety)\n  useEffect(() => {\n    setShowLegend(chartH * CHART_SCALE > 220);\n  }, [chartH]);\n\n  // --- Plot calibration: measure real grid box and align overlay ---\n  useLayoutEffect(() => {\n    const host = chartHostRef.current;\n    const ov = overlayRef.current;\n    if (!host || !ov) return;\n    const gridG = host.querySelector('g.recharts-cartesian-grid');\n    if (!gridG || !gridG.getBoundingClientRect) return;\n    const gridRect = gridG.getBoundingClientRect();\n    const ovRect = ov.getBoundingClientRect();\n    const scaleY = gridRect.height / Math.max(1, ovRect.height);\n    const deltaTop = gridRect.top - ovRect.top; // 上端の差（オーバーレイ→グリッド）\n    plotCalRef.current = { scaleY, deltaTop };\n  });\n\n  // --- Dev sanity checks (non-intrusive) ---\n  useEffect(() => {\n    try {\n      console.assert(Array.isArray(FREQS) && FREQS.length === 7, 'FREQS should have 7 items');\n      console.assert(SERIES.every(s => s.key && s.color && s.shape), 'SERIES entries must have key/color/shape');\n      const sampleTicks = Array.from({length: FREQS.length}, (_,i)=> i).map(formatFreq);\n      console.assert(sampleTicks.every(t => String(t).length > 0), 'formatFreq should produce labels');\n      // quick unit-like check for getThr mapping using PRESET_A\n      const tmap = new Map();\n      PRESET_A.targets.filter(t=>t.masked===false).forEach(t=>{\n        const key = `${t.ear}|${t.transducer}|${t.freq}`;\n        const base = t.so ? ((t.transducer==='AC'?(AC_MAX[t.freq]??110):(BC_MAX[t.freq]??110))+50) : t.dB;\n        tmap.set(key, {dB: base});\n      });\n      const k = 'R|AC|1000';\n      console.assert(tmap.get(k)?.dB === 5, 'getThr baseline sanity (R AC 1kHz should be 5 dB)');\n      // helpers\n      console.assert(round5(52) === 50 && round5(53) === 55, 'round5 should snap to nearest 5');\n      console.assert(maxPresentable('AC', 1000) === 110, 'AC max @1k should be 110');\n      // ensure getThr (component-scope) resolves with targetMap in place\n      console.assert(Number.isFinite(getThr('R','AC',1000)), 'getThr should resolve for R AC 1k');\n\n      // === Added self-tests per spec (1) 5dB丸め, (2) -10/120クランプ, (3) 0/50/100整合 ===\n      // Pure mapping test with synthetic geometry\n      const yMin=-10, yMax=120, gridH= (yMax - yMin); // 1px == 1dB for synthetic\n      const mapYToDb = (y)=> yMin + (Math.max(0, Math.min(gridH, y)) / gridH) * (yMax - yMin);\n      const assertNear5 = (val, expect)=> console.assert(Math.abs(round5(val) - expect) <= 0, `round5(${val}) ~= ${expect}`);\n      assertNear5(mapYToDb( (0) ), -10);\n      assertNear5(mapYToDb( gridH*0.5 ), 55); // 中央\n      assertNear5(mapYToDb( gridH ), 120);\n      // clamp extremes\n      console.assert(Math.min(yMax, Math.max(yMin, -15)) === -10, 'clamp top to -10dB');\n      console.assert(Math.min(yMax, Math.max(yMin, 130)) === 120, 'clamp bottom to 120dB');\n\n      // showLegend presence\n      console.assert(typeof showLegend === 'boolean', 'showLegend should be boolean');\n\n      // masking logic quick checks\n      const targets = PRESET_A.targets;\n      const localMap = new Map();\n      targets.filter(t=>t.masked===false).forEach(t=>{\n        const overMax = (t.transducer==='AC' ? (AC_MAX[t.freq] ?? 110) : (BC_MAX[t.freq] ?? 110)) + 50;\n        localMap.set(`${t.ear}|${t.transducer}|${t.freq}`, { dB: t.so ? overMax : t.dB });\n      });\n      const _getThr = (earKey, transKey, f)=> (localMap.get(`${earKey}|${transKey}|${f}`)?.dB ?? Infinity);\n      const _hears = (earKey, transKey, f, L, maskedFlag, maskLvl)=>{\n        const teThr = _getThr(earKey, transKey, f);\n        const testEarHeard = L >= teThr;\n        const nte = earKey === 'R' ? 'L' : 'R';\n        const ia = IA[transKey] ?? 0;\n        const leakedToNTE = L - ia;\n        const nteBC = _getThr(nte, 'BC', f);\n        const effectiveMask = (maskedFlag && maskLvl > nteBC) ? maskLvl : nteBC;\n        const crossHeard = leakedToNTE >= effectiveMask;\n        return testEarHeard || crossHeard;\n      };\n      console.assert(_hears('R','AC',1000,10,false,-15) === true, 'test-ear hears >= thr');\n      console.assert(_hears('R','AC',2000,70,true,80) === true, 'effective masking keeps true via test-ear');\n    } catch (e) {\n      console.warn('Sanity check failed:', e);\n    }\n  }, [showLegend]);\n\n  // Overlay answer (blink)\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [overMaskingWarning, setOverMaskingWarning] = useState(true); // オーバーマスキング警告のON/OFF\n  const [blinkOn, setBlinkOn] = useState(true);\n\n  useEffect(() => {\n    if (!showAnswer) return;\n    const id = setInterval(() => setBlinkOn(b => !b), 700);\n    return () => clearInterval(id);\n  }, [showAnswer]);\n\n  // Debug: log showAnswer state changes\n  useEffect(() => {\n    console.log('showAnswer changed:', showAnswer);\n  }, [showAnswer]);\n\n  // Keyboard: Arrow keys for navigation and level control\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const onKeyDown = (e) => {\n      const el = e.target;\n      const tag = (el && el.tagName) ? el.tagName.toUpperCase() : '';\n      const type = (el && el.type) ? String(el.type).toLowerCase() : '';\n      const isTypingField = (tag === 'INPUT' && (type === 'text' || type === 'number' || type === 'search' || type === 'email' || type === 'password'))\n                           || tag === 'TEXTAREA'\n                           || (el && el.isContentEditable === true);\n      if (isTypingField) return;\n\n      // 周波数変更（左右キー）\n      if (e.key === 'ArrowRight') {\n        e.preventDefault();\n        console.log('右キー押下');\n        setFreq((prev) => {\n          const idx = Math.max(0, FREQS.indexOf(prev));\n          let nextIdx = Math.min(FREQS.length - 1, idx + 1);\n          // BC測定時は125Hz/8000Hzをスキップ\n          if (trans === 'BC') {\n            while (BC_DISABLED.has(FREQS[nextIdx])) {\n              nextIdx = Math.min(FREQS.length - 1, nextIdx + 1);\n              if (nextIdx === FREQS.length - 1) break;\n            }\n          }\n          return FREQS[nextIdx];\n        });\n      }\n      if (e.key === 'ArrowLeft') {\n        e.preventDefault();\n        console.log('左キー押下');\n        setFreq((prev) => {\n          const idx = Math.max(0, FREQS.indexOf(prev));\n          let nextIdx = Math.max(0, idx - 1);\n          // BC測定時は125Hz/8000Hzをスキップ\n          if (trans === 'BC') {\n            while (BC_DISABLED.has(FREQS[nextIdx])) {\n              nextIdx = Math.max(0, nextIdx - 1);\n              if (nextIdx === 0) break;\n            }\n          }\n          return FREQS[nextIdx];\n        });\n      }\n\n      // レベル調整（上下キー）- 上下を逆にして、自動打点\n      if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        console.log('上キー押下');\n        setLevel((prev) => {\n          const newLevel = Math.min(Y_MAX, prev - 5); // 上キーで-5dB\n          setSuppressLamp(false);\n          // 自動で打点追加\n          setTimeout(() => {\n            addOrReplacePoint({ ear, transducer: trans, masked, freq, dB: round5(newLevel) });\n          }, 50);\n          return newLevel;\n        });\n      }\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        console.log('下キー押下');\n        setLevel((prev) => {\n          const newLevel = Math.max(Y_MIN, prev + 5); // 下キーで+5dB\n          setSuppressLamp(false);\n          // 自動で打点追加\n          setTimeout(() => {\n            addOrReplacePoint({ ear, transducer: trans, masked, freq, dB: round5(newLevel) });\n          }, 50);\n          return newLevel;\n        });\n      }\n\n      // Deleteキーで現在の打点削除\n      if (e.key === 'Delete' || e.key === 'Backspace') {\n        e.preventDefault();\n        removePointAtCurrent();\n      }\n    };\n    window.addEventListener('keydown', onKeyDown, { capture: true });\n    return () => {\n      window.removeEventListener('keydown', onKeyDown, { capture: true });\n    };\n  }, [ear, trans, masked, freq, level]);\n\n  // 周波数が変わったら一度ランプを消灯\n  useEffect(() => { setSuppressLamp(true); }, [freq]);\n\n  const freqIndex = useMemo(() => Math.max(0, FREQS.indexOf(freq)), [freq]);\n  function moveFreq(dir /* -1 | 1 */) {\n    let idx = clamp(freqIndex + dir, 0, FREQS.length - 1);\n    // BC時は125/8000Hzをスキップ\n    if (trans === 'BC') {\n      while (BC_DISABLED.has(FREQS[idx])) {\n        idx = clamp(idx + dir, 0, FREQS.length - 1);\n        if (idx === 0 || idx === FREQS.length - 1) break;\n      }\n    }\n    setFreq(FREQS[idx]);\n  }\n\n  // clicking on chart -> add/replace point for current ear/trans/masked+freq\n  function addOrReplacePoint(p) {\n    if (p.transducer === 'BC' && BC_DISABLED.has(p.freq)) {\n      setSuppressLamp(true);\n      return;\n    }\n    const p2 = { ...p, masked: p.masked };\n    const max = maxPresentable(p2.transducer, p2.freq);\n    const atMax = p2.dB >= max;\n    const heardAtMax = hearsAtLevel(p2.ear, p2.transducer, p2.freq, max);\n    const so = atMax && !heardAtMax;\n    const p3 = { ...p2, dB: atMax ? max : p2.dB, ...(so ? { so: true } : {}) };\n\n    setPoints(prev => {\n      const k = (x) => `${x.ear}|${x.transducer}|${x.masked ? 'M' : 'U'}|${x.freq}`;\n      const kp = k(p3);\n      const others = prev.filter(q => k(q) !== kp);\n      return [...others, p3].sort((a,b)=> (a.freq-b.freq) || (a.dB-b.dB));\n    });\n    setSuppressLamp(false);\n  }\n\n  // Precise hit: map overlay click to real grid using measured scale/offset\n  function handlePlotClick(e){\n    if (trans === 'BC' && BC_DISABLED.has(freq)) { setSuppressLamp(true); return; }\n    const ov = overlayRef.current;\n    if (!ov) return;\n    const ovRect = ov.getBoundingClientRect();\n    \n    // クリック位置をオーバーレイ内の相対座標に変換\n    const clickX = e.clientX - ovRect.left;\n    const clickY = e.clientY - ovRect.top;\n    \n    // Y軸の範囲を計算（オーディオグラムは上から下に-10dBから120dB）\n    const yRange = Y_MAX - Y_MIN; // 130dB\n    const yRatio = clickY / ovRect.height; // 0から1の比率\n    \n    // RechartsのY軸はreversed=trueなので、座標変換を修正\n    // 上（yRatio=0）が120dB、下（yRatio=1）が-10dB\n    let dBraw = Y_MIN + (yRatio * yRange);\n    dBraw += CAL_OFFSET_DB; // optional small offset (kept 0 by default)\n    const dBclamped = clamp(round5(dBraw), Y_MIN, Y_MAX);\n\n    const max = maxPresentable(trans, freq);\n    const atMax = dBclamped >= max;\n    const heardAtMax = hearsAtLevel(ear, trans, freq, max);\n    const so = atMax && !heardAtMax;\n\n    const p = { ear, transducer: trans, masked, freq, dB: atMax ? max : dBclamped, ...(so ? { so: true } : {}) };\n    addOrReplacePoint(p);\n    setLevel(p.dB);\n    setSuppressLamp(false);\n  }\n\n  function removePointAtCurrent() {\n    setPoints(prev => prev.filter(q => !(\n      q.ear===ear && q.transducer===trans && q.freq===freq && q.masked===masked\n    )));\n  }\n  function clearAll() { setPoints([]); }\n\n  // ---- Target lookup for cross-hearing & lamp logic ----\n  const targetMap = useMemo(() => {\n    const map = new Map();\n    (targets||[]).forEach(t => {\n      if (!t || t.masked !== false || typeof t.freq !== 'number') return;\n      const overMax = (t.transducer==='AC' ? (AC_MAX[t.freq] ?? 110) : (BC_MAX[t.freq] ?? 110)) + 50;\n      const dB = t.so ? overMax : t.dB;\n      map.set(`${t.ear}|${t.transducer}|${t.freq}`, { dB });\n    });\n    return map;\n  }, [targets]);\n\n  // オーバーマスキング検出\n  const isOverMasking = useMemo(() => {\n    if (!masked || !overMaskingWarning) return false;\n    \n    const testEarThreshold = getThr(ear, trans, freq);\n    if (testEarThreshold === Infinity) {\n      return false;\n    }\n    \n    // マスキングの上限 = 測定耳閾値 + 50dB\n    const maskingLimit = testEarThreshold + 50;\n    \n    // マスキングレベルが上限を超えている場合\n    return maskLevel > maskingLimit;\n  }, [masked, maskLevel, ear, trans, freq, overMaskingWarning, targetMap]);\n\n  function getThr(earKey, transKey, f) {\n    const key = `${earKey}|${transKey}|${f}`;\n    const v = targetMap.get(key);\n    \n    \n    if (v && typeof v.dB === 'number') {\n      // SO（Scale-Out）の場合は最大値+50dBを返す\n      if (v.dB >= 110) {\n        return (transKey === 'AC' ? (AC_MAX[f] ?? 110) : (BC_MAX[f] ?? 110)) + 50;\n      }\n      return v.dB;\n    }\n    return Infinity; // missing → treat as no response\n  }\n\n  function hearsAtLevel(earKey, transKey, f, L) {\n    const teThr = getThr(earKey, transKey, f);\n    const testEarHeard = L >= teThr;\n    const nte = earKey === 'R' ? 'L' : 'R';\n    const ia = IA[transKey] ?? 0;\n    const leakedToNTE = L - ia;\n    \n    // マスキングの基本原理：\n    // AC測定時：非測定耳のBC閾値と比較\n    // BC測定時：非測定耳のBC閾値と比較\n    const nteBC = getThr(nte, 'BC', f);\n    \n    // マスキングの計算\n    let effectiveMask = nteBC;\n    if (masked && maskLevel > nteBC) {\n      // マスキングレベルが非測定耳BC閾値より高い場合\n      effectiveMask = maskLevel;\n    }\n    \n    const crossHeard = leakedToNTE >= effectiveMask;\n    \n    return testEarHeard || crossHeard;\n  }\n\n  // series data (user)\n  const seriesData = useMemo(() => {\n    const m = {}; SERIES.forEach(s => m[s.key] = []);\n    points.forEach(p => {\n      const key = seriesKey(p);\n      if (!m[key]) m[key] = [];\n      const i = Math.max(0, FREQS.indexOf(p.freq));\n      const xIdx = i;\n      m[key].push({ x: xIdx, idx: i, y: p.dB, ...(p.so ? { so: true } : {}) });\n    });\n    return m;\n  }, [points]);\n\n  // AC lines (connect) — break at Scale-Out and at gaps\n  const acLineData = useMemo(() => {\n    const out = {};\n    SERIES.filter(s => s.key.includes('-AC-')).forEach(s => {\n      out[s.key] = FREQS.map((_, i) => ({ x: i, y: null }));\n      const pts = seriesData[s.key] || [];\n      pts.forEach(p => {\n        const i = p.x;\n        if (!p || typeof i !== 'number') return;\n        out[s.key][i] = p.so ? { x: i, y: null } : { x: i, y: p.y };\n      });\n    });\n    return out;\n  }, [seriesData]);\n\n  // Build answer overlay series from loaded targets (markers)\n  const answerSeriesData = useMemo(() => {\n    const m = {}; SERIES.forEach(s => m[s.key] = []);\n    (targets||[]).forEach(t => {\n      if (t.transducer === 'BC' && BC_DISABLED.has(t.freq)) return;\n      const i = Math.max(0, FREQS.indexOf(t.freq));\n      const xIdx = i;\n      const isSO = !!t.so;\n      const yVal = isSO\n        ? (t.transducer === 'AC' ? (AC_MAX[t.freq] ?? 110) : (BC_MAX[t.freq] ?? 110))\n        : t.dB;\n      // BCの場合は常にmaskedのキーを使用\n      const key = t.transducer === 'BC' \n        ? `${t.ear}-${t.transducer}-M` \n        : `${t.ear}-${t.transducer}-${t.masked ? 'M' : 'U'}`;\n      m[key] = m[key] || [];\n      m[key].push({ x: xIdx, y: yVal, ...(isSO ? { so:true } : {}) });\n    });\n    console.log('answerSeriesData generated:', m);\n    return m;\n  }, [targets]);\n\n  // Answer AC lines: break at SO and at gaps by inserting null placeholders\n  const answerLineData = useMemo(() => {\n    const out = {};\n    SERIES.filter(s => s.key.includes('-AC-')).forEach(s => {\n      out[s.key] = FREQS.map((_, i) => ({ x: i, y: null }));\n      const pts = (answerSeriesData[s.key] || []);\n      pts.forEach(p => {\n        const i = p.x;\n        if (!p || typeof i !== 'number') return;\n        out[s.key][i] = p.so ? { x: i, y: null } : { x: i, y: p.y };\n      });\n    });\n    return out;\n  }, [answerSeriesData]);\n\n  // Response lamp (current condition vs target >= OR cross-hearing)\n  const currentTarget = useMemo(() => (targets||[]).find(x => x.ear===ear && x.transducer===trans && x.masked===false && x.freq===freq), [targets, ear, trans, freq]);\n  const lampOn = useMemo(() => {\n    if (!currentTarget) return false;\n    if (suppressLamp) return false; // 抑制中は消灯\n    const L = round5(level);\n    \n    // クロスヒアリングを考慮した応答判定\n    return hearsAtLevel(ear, trans, freq, L);\n  }, [currentTarget, level, ear, trans, freq, masked, maskLevel, targetMap, suppressLamp]);\n\n  // オーバーマスキングを考慮した実際の閾値を取得\n  function getActualThreshold(earKey, transKey, f) {\n    const baseThreshold = getThr(earKey, transKey, f);\n    \n    if (masked && transKey === 'BC') {\n      // BC測定時のオーバーマスキング計算\n      // マスキングの上限 = 測定耳BC閾値 + 50dB\n      const maskingLimit = baseThreshold + 50;\n      \n      if (maskLevel > maskingLimit) {\n        // オーバーマスキング発生\n        const overMasking = maskLevel - maskingLimit;\n        return baseThreshold + overMasking;\n      }\n    }\n    \n    return baseThreshold;\n  }\n\n  // パスワード認証画面\n  if (!isAuthenticated) {\n    return (\n      <div className=\"w-full min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full mx-4\">\n          <div className=\"text-center mb-6\">\n            <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">オーディオグラム講習会</h1>\n            <p className=\"text-gray-600\">参加用パスワードを入力してください</p>\n          </div>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">パスワード</label>\n              <input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && password === TRAINING_PASSWORD && setIsAuthenticated(true)}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                placeholder=\"講習会パスワード\"\n              />\n            </div>\n            <button\n              onClick={() => password === TRAINING_PASSWORD && setIsAuthenticated(true)}\n              disabled={password !== TRAINING_PASSWORD}\n              className=\"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed\"\n            >\n              参加する\n            </button>\n          </div>\n          <div className=\"mt-6 text-center text-sm text-gray-500\">\n            パスワード: audiogram2024\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full min-h-screen p-6 md:p-10 bg-gray-50 text-gray-900\" ref={containerRef}>\n      <div className=\"max-w-7xl mx-auto grid gap-6\">\n        <header className=\"flex flex-col md:flex-row md:items-end md:justify-between gap-3\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-bold\">Simple Audiogram builder (Masking simulator)</h1>\n            <p className=\"text-sm text-gray-600 mt-1\">講習会参加中 - 講師の指示に従って操作してください</p>\n          </div>\n          <button\n            onClick={() => setIsAuthenticated(false)}\n            className=\"px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300\"\n          >\n            退出\n          </button>\n        </header>\n\n        {/* 講習会用説明 */}\n        <div className=\"bg-blue-50 border border-blue-200 rounded-2xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"text-blue-600 text-xl\">📚</div>\n            <div>\n              <div className=\"font-semibold text-blue-800\">講習会参加者の方へ</div>\n              <div className=\"text-sm text-blue-700 mt-1\">\n                • 講師の指示に従って症例を選択してください<br/>\n                • 各自で操作しながら学習を進めてください<br/>\n                • 質問がある場合はチャットでお聞きください<br/>\n                • 正答表示は講師の指示があるまで待ってください\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* キーボード操作説明 */}\n        <div className=\"bg-green-50 border border-green-200 rounded-2xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"text-green-600 text-xl\">⌨️</div>\n            <div>\n              <div className=\"font-semibold text-green-800\">キーボード操作</div>\n              <div className=\"text-sm text-green-700 mt-1\">\n                <strong>カーソルキー:</strong> ←→周波数変更 | ↑-5dB調整(自動打点) | ↓+5dB調整(自動打点)<br/>\n                <strong>削除:</strong> DeleteキーまたはBackspaceキーで現在の打点削除<br/>\n                <strong>マウス:</strong> チャートクリックでも打点可能\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Preset loader (secret) */}\n        <div className=\"bg-white rounded-2xl shadow p-4\">\n          <div className=\"flex flex-wrap items-center gap-3\">\n            <span className=\"text-sm text-gray-600\">症例プリセット</span>\n            <select className=\"border rounded-xl px-2 py-1 text-sm\" value={selectedPreset} onChange={(e)=> setSelectedPreset(e.target.value)}>\n              <option value=\"A\">症例A</option>\n              <option value=\"B\">症例B</option>\n              <option value=\"C\">症例C</option>\n              <option value=\"D\">症例D</option>\n              <option value=\"E\">症例E</option>\n              <option value=\"F\">症例F</option>\n            </select>\n            <button className=\"px-3 py-2 rounded-xl bg-teal-600 text-white text-sm\" onClick={()=>{\n              const p = selectedPreset==='A' ? PRESET_A : selectedPreset==='B' ? PRESET_B : selectedPreset==='C' ? PRESET_C : selectedPreset==='D' ? PRESET_D : selectedPreset==='E' ? PRESET_E : PRESET_F;\n              setPoints([]);\n              setTargets(buildTargetsFromPreset(p));\n            }}>LOAD</button>\n            <span className=\"text-xs text-gray-400\">※ LOADでプロットは自動クリア。正答は画面に表示しません（照合/オーバーレイ用）。</span>\n          </div>\n        </div>\n\n        {/* Controls */}\n        <div className=\"bg-white rounded-2xl shadow p-5\">\n          <div className=\"grid md:grid-cols-6 gap-4 text-sm\">\n            <Control label=\"Ear\">\n              <div className=\"flex gap-2\">\n                <button onClick={() => { setEar('R'); setFreq(1000); setSuppressLamp(true); }} className={`px-3 py-2 rounded-lg border text-base ${ear==='R' ? 'bg-red-600 text-white border-red-600' : 'bg-white text-red-600 border-red-600'}`}>Right</button>\n                <button onClick={() => { setEar('L'); setFreq(1000); setSuppressLamp(true); }} className={`px-3 py-2 rounded-lg border text-base ${ear==='L' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-blue-600 border-blue-600'}`}>Left</button>\n              </div>\n            </Control>\n            <Control label=\"Transducer\">\n              <div className=\"flex gap-2\">\n                <TinyToggle active={trans==='AC'} onClick={() => { setTrans('AC'); setFreq(1000); setSuppressLamp(true); }}>AC</TinyToggle>\n                <TinyToggle active={trans==='BC'} onClick={() => { setTrans('BC'); setFreq(1000); setSuppressLamp(true); }}>BC</TinyToggle>\n              </div>\n            </Control>\n            <Control label=\"Frequency\">\n              <div className=\"flex items-center gap-2\">\n                <button onClick={() => moveFreq(-1)} className=\"px-2 py-1 rounded-lg border\">◀</button>\n                <div className=\"font-mono w-24 text-center\">{freq} Hz</div>\n                <button onClick={() => moveFreq(1)} className=\"px-2 py-1 rounded-lg border\">▶</button>\n              </div>\n            </Control>\n            <Control label=\"Level (dB HL)\">\n              <div className=\"flex items-center gap-3\">\n                <input type=\"range\" min={Y_MIN} max={Y_MAX} step={5} value={level} onChange={e => { setLevel(parseInt(e.target.value)); setSuppressLamp(false); }} className=\"w-full\" />\n                <div className=\"font-mono w-16 text-right\">{level}</div>\n              </div>\n            </Control>\n            <Control label=\"打点\">\n              <div className=\"flex gap-2\">\n                <button onClick={() => addOrReplacePoint({ ear, transducer: trans, masked, freq, dB: round5(level) })} className=\"px-3 py-2 rounded-xl bg-indigo-600 text-white\">追加/更新</button>\n                <button onClick={removePointAtCurrent} className=\"px-3 py-2 rounded-xl bg-white border\">削除</button>\n                <button onClick={clearAll} className=\"px-3 py-2 rounded-xl bg-white border\">全クリア</button>\n              </div>\n            </Control>\n          </div>\n          <p className=\"text-xs text-gray-500 mt-2\">\n            ※ チャートをクリックしても打点できます（現在選択中のEar/Transducer/Masking・周波数列に対して）。<br/>\n            ※ キーボード操作: ←→周波数変更 | ↑-5dB調整(自動打点) | ↓+5dB調整(自動打点) | Delete打点削除\n          </p>\n        </div>\n\n        {/* オーバーマスキング警告 */}\n        {isOverMasking && (\n          <div className=\"bg-red-50 border border-red-200 rounded-2xl p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"text-red-600 text-xl\">⚠️</div>\n              <div>\n                <div className=\"font-semibold text-red-800\">オーバーマスキングの可能性あり！！</div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Audiogram */}\n        <div className=\"bg-white rounded-2xl shadow p-5\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h2 className=\"text-lg font-semibold\">Audiogram</h2>\n            <div className={`flex items-center gap-2 px-2 py-1 rounded-full border ${lampOn ? 'bg-orange-50 border-orange-300' : 'bg-white border-gray-300'}`}>\n              <div className={`w-3.5 h-3.5 rounded-full ${lampOn ? 'bg-orange-500' : 'bg-gray-300'}`} />\n              <span className=\"text-xs\">応答ランプ</span>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-xs text-gray-600\">Masking (NTE: {ear === 'R' ? 'L' : 'R'})</span>\n              <div className=\"flex items-center gap-2\">\n                <TinyToggle active={!masked} onClick={() => { setMasked(false); setMaskLevel(-15); }}>Unmasked</TinyToggle>\n                <TinyToggle active={masked} onClick={() => { setMasked(true); if (maskLevel < 0) setMaskLevel(0); }}>Masked</TinyToggle>\n              </div>\n              <div className=\"flex items-center gap-2 min-w-[180px]\">\n                <input type=\"range\" min={-15} max={110} step={5} value={maskLevel} onChange={e => setMaskLevel(parseInt(e.target.value))} className=\"w-40\" />\n                <div className=\"w-16 text-right text-xs font-mono\">{maskLevel} dB</div>\n              </div>\n              <button onClick={() => setShowAnswer(a => !a)} className={`px-2 py-1 rounded-lg border text-xs ${showAnswer ? 'bg-emerald-600 text-white border-emerald-600' : 'bg-white text-gray-800'}`} title=\"正答（オーバーレイ）を表示/非表示\">\n                {showAnswer ? '正答表示: ON' : '正答表示: OFF'}\n              </button>\n              <button onClick={() => setOverMaskingWarning(w => !w)} className={`px-2 py-1 rounded-lg border text-xs ${overMaskingWarning ? 'bg-yellow-600 text-white border-yellow-600' : 'bg-white text-gray-800'}`} title=\"オーバーマスキング警告のON/OFF\">\n                {overMaskingWarning ? '警告: ON' : '警告: OFF'}\n              </button>\n            </div>\n          </div>\n\n          <div className=\"flex items-stretch gap-0 items-start\">\n            <div ref={chartHostRef} className=\"relative chart-host\" style={{ width: chartW, height: chartH, overflow: 'visible' }}>\n              <div\n                ref={overlayRef}\n                className=\"absolute\"\n                style={{ left: CHART_MARGIN.left, top: CHART_MARGIN.top, width: GRID_W, height: GRID_H, cursor: 'crosshair', zIndex: 10, pointerEvents: 'auto', background: 'transparent' }}\n                onPointerUp={handlePlotClick}\n                onPointerDown={(e)=>e.preventDefault()}\n              />\n              <ComposedChart width={chartW} height={chartH} data={[]} margin={CHART_MARGIN}>\n                  <CartesianGrid strokeDasharray=\"3 3\" />\n                  <XAxis type=\"number\" dataKey=\"x\" domain={X_DOMAIN} ticks={Array.from({ length: FREQS.length }, (_, i) => i)} tickFormatter={formatFreq} label={{ value: 'Frequency (Hz) - 1 octave/grid', position: 'bottom', offset: 6, style: { fontSize: 18 } }} tick={{ fontSize: 18 }} />\n                  <YAxis type=\"number\" dataKey=\"y\" domain={[Y_MIN, Y_MAX]} ticks={Array.from({ length: (Y_MAX - Y_MIN) / 10 + 1 }, (_, i) => Y_MIN + i * 10)} reversed={true} tickMargin={6} label={{ value: 'Hearing Level (dB HL) - 10 dB/grid', angle: -90, position: 'left', offset: 0, dy: -100, style: { fontSize: 18 } }} tick={{ fontSize: 18 }} />\n                  <Line data={[{ x: 0, y: 0 }, { x: FREQS.length - 1, y: 0 }]} dataKey=\"y\" xAxisId={0} yAxisId={0} type=\"monotone\" dot={false} stroke=\"#94a3b8\" strokeWidth={2} />\n\n                  {SERIES.map(s => (\n                    <Scatter key={s.key} name={s.label} data={(seriesData[s.key] || []).map(d => ({ x: d.x, y: d.y, ...(d.so ? { so: true } : {}) }))} fill={s.color} shape={shapeRenderer(s.shape, s.color)} />\n                  ))}\n\n                  {SERIES.filter(s => s.key.includes('-AC-')).map(s => (\n                    <Line key={`line-${s.key}`} data={acLineData[s.key] || []} dataKey=\"y\" stroke={s.color} strokeWidth={2} dot={false} strokeDasharray={s.key.startsWith('L-') ? '6 4' : undefined} type=\"linear\" connectNulls={false} />\n                  ))}\n\n                  {showAnswer && SERIES.map(s => (\n                    <Scatter key={`ans-${s.key}`} name={`${s.label} (answer)`} data={answerSeriesData[s.key] || []} fill=\"#10b981\" shape={(props) => (<g style={{ opacity: blinkOn ? 1 : 0 }}>{shapeRenderer(s.shape, '#10b981')(props)}</g>)} isAnimationActive={false} />\n                  ))}\n                  {showAnswer && SERIES.filter(s => s.key.includes('-AC-')).map(s => (\n                    <Line key={`ans-line-${s.key}`} data={answerLineData[s.key] || []} dataKey=\"y\" stroke=\"#10b981\" strokeOpacity={0.35} isAnimationActive={false} strokeWidth={2} dot={false} strokeDasharray={'4 6'} type=\"linear\" connectNulls={false} />\n                  ))}\n                </ComposedChart>\n            </div>\n            {showLegend && (\n              <div className=\"shrink-0 pl-2\" style={{ display: 'flex', alignItems: 'flex-start' }}>\n                <ul className=\"space-y-0.5 text-[16px] leading-tight pr-1\">\n                  {SERIES.map(s => (\n                    <li key={s.key} className=\"flex items-center gap-2\">\n                      <LegendMark shape={s.shape} color={s.color} />\n                      <span>{s.label}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// small UI helpers\nfunction Control({ label, children }) {\n  return (\n    <div>\n      <div className=\"text-gray-700 mb-1 text-base\">{label}</div>\n      {children}\n    </div>\n  );\n}\n\nfunction TinyToggle({ active, onClick, children }) {\n  return (\n    <button\n      onClick={onClick}\n      className={`px-3 py-2 rounded-lg border text-base ${active ? 'bg-black text-white border-black' : 'bg-white text-gray-800'}`}\n    >\n      {children}\n    </button>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}